---
title: HCB Markeplace – Устаревшие методы API

language_tabs: # must be one of https://git.io/vQNgJ
  - json


toc_footers:
  - <a href='https://docs.homecred.it/'>Главная</a>
  - <a href='https://market.homecredit.ru'>Сервис "Товары в рассрочку"</a>
  - <a href='mailto:MPIntegration@homecredit.ru'>Обратная связь</a>

includes:
search: false
---

# Описание устаревших методов API (2.0 и 1.0)

Описание методов партнерского API которое представлено ниже – это устаревшие методы, ставшие частью истории нашего сервиса. Мы все еще сохраняем поддержку этих версий для обеспечения обратной совместимости, но они не поддерживают большую часть новой и классной функциональности, которую мы внедряем и развиваем на сервисе. Чтобы вернуться к описанию актуальных методов партнерского API, нажмите <a href='https://docs.homecred.it/#api-2-1'>сюда</a>.

# API версии 2.0 с поддержкой корзины товаров

## → POST /order/check
**Проверка наличия товара у партнера.**<br>
Метод **check** означает поступающий партнеру запрос на проверку наличия одного или нескольких товаров в выбранном покупателем регионе и вызывается в двух случаях:

* когда покупатель добавляет товар в корзину (в запросе отправляется один массив с offerId)
* в момент когда покупатель переходит из корзины к оформлению заказа (в запросе отправляются все товары, которые покупатель добавил в корзину, это может быть один или несколько массивов с  разными offerId и productCode)

В ответ на запрос партнер должен уведомить о доступности товара, а также прислать условия доставки и самовывоза. Расчет стоимости и срока доставки заказа (в том числе на пункт выдачи) должен производиться на основе доступных для резерва товаров. (Например, если доступно только 3 из 5 переданных в запросе позиций, стоимость доставки должна быть расчитана только для них).

### Входные параметры
`POST https://example.com/order/check`
> Пример запроса POST /order/check:

```shell
curl -X POST https://example.com/order/check \
  -H 'Content-Type: application/json' \
  -H 'cache-control: no-cache' \
  -d '{"offersRequest":[
  {
    "offerId":"123",
    "quantity":1,
    "regionId":77,
    "productCode":"0-0-6"
  },
  {
    "offerId":"456",
    "quantity":1,
    "regionId":77,
    "productCode":"0-0-12"
  }
]}'
```

| Параметр                                                      | Обязательность | Описание                                                                           |
|---------------------------------------------------------------|----------------|------------------------------------------------------------------------------------|
| `offersRequest`<br>  Array of [{offerRequest}](#offerrequest) | Обязательно    | Массив объектов с запросом на проверку наличия товаров, которые выбрал покупатель. |

**Объект offerRequest**

| Параметр                  | Обязательность | Описание                                                                                                             |
|---------------------------|----------------|----------------------------------------------------------------------------------------------------------------------|
| `offerId` <br> string     | Обязательно    | Идентификатор товара из YML-каталога.                                                                                |
| `quantity`<br>integer     | Обязательно    | Количество единиц товара для бронирования.                                                                           |
| `regionId` <br>integer    | Обязательно    | Идентификатор региона                                                                                                |
| `productCode`<br> string  | Необязательно  | Код кредитного продукта (срок рассрочки).<br> Примеры:<ul><li>0-0-3</li><li>0-0-6</li><li>0-0-10</li><li>0-0-12</li><li>0-0-18</li><li>0-0-24</li><li>0-0-36</li></ul> |

<aside class="warning">
Срок рассрочки является важным параметром только для процесса с кредитным договором и будет удален из запроса в версии API 2.1 (с поддержкой кредитного лимита).
</aside>

###Параметры ответа
`HTTP status code 200 OK — Список товаров с указанием наличия и условий.`
> Пример ответа в JSON:

```json
{
   "offersResponse":[
      {
         "status":"available",
         "offerId":"123",
         "quantity":1,
         "points":[
            "0"
         ]
      },
      {
         "status":"available",
         "offerId":"456",
         "quantity":1,
         "points":[
            "0"
         ]
      }
   ],
   "DeliveryOptions":{
      "delivery":[
         {
            "DeliveryID":1,
            "DeliveryName":"Доставка СДЭК",
            "Cost":1000,
            "Days":"1-2"
         }
      ]
   }
}
```

| Параметр | Обязательность | Описание |
|-------------------------------------------|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| offersResponse Array of [{offerResponse}](#offerresponse)| Обязательно | Массив объектов со статусом резерва по каждому из запрошенных товаров. |
| DeliveryOptions [{DeliveryOption}](#deliveryoption)| Обязательно | Дополнительная информация по параметрам доставки, которую сможет выбрать покупатель. Партнер должен предоставить варианты доставки для всей группы товаров. |

**Объект offerResponse**
<aside class="notice">
В случае наличия самовывоза, необходимо сначала указать deliveryOptions со всеми доступными точками самовывоза, при этом для каждого оффера должно быть указано, в какой точке он конкретно доступен в массиве "points".
</aside>

| Параметр | Обязательность | Описание |
|----------|----------------|-------------------------------------------------------------------------------------------------------------------------------------|
| `offerId`<br>string | Обязательно | Идентификатор товара из YML-каталога. |
| `status`<br>string | Обязательно | Варианты:<ul><li>‘available’ — товар доступен;</li><li>‘unavailable’ — товар недоступен.</li></ul> |
| `quantity`<br>integer | Обязательно | Доступное количество товара. |
| `points`<br> Array of string | Обязательно | Идентификаторы пунктов самовывоза, в которых доступен товар.<br>Также необходимо добавлять в список 0, если доступна доставка курьером. Пустой массив - товар недоступен. |
| `reason`<br>string | Необязательно | Указывается, если товар недоступен (пример: “not in stock”). |


**Объект DeliveryOption**
<aside class="warning">
Обратите внимание, что объект "deliveryOptions"(опции по доставке) должен быть один для всех офферов!
Соответственно, стоимость доставки передается общей суммой за доставку нескольких товаров.
</aside>

| Параметр | Обязательность | Описание  |
|---------------------------------|----------------|---------------------------------------------------------------------------------------------------------------------------------|
| `delivery`<br> Array of Objects | Обязательно, при наличии доставки | Список вариантов доставки с указанием параметров: <ul><li>**deliveryId** (int) — идентификатор службы доставки в системе партнера (будет передано при резервировании заказа);</li> <li>**deliveryName** (string) — название службы доставки (будет отображено Покупателю);</li> <li>**cost** (int) — стоимость доставки (если параметр отсутствует, то стоимость необходимо уточнять у службы доставки);</li><li>**days** (string) — время доставки в днях (возможно указать интервал “5-7”, который интерпретируется как “доставка от 5 до 7 дней”).</li></ul>|
| `pickup`<br> Array of Objects | Обязательно, при наличии самовывоза | Список точек самовывоза доступные для заказа с указанием параметров:<ul><li> **point** (string) — идентификатор точки самовывоза из CSV;</li> <li>**cost** (int) — стоимость за услугу самовывоза, можно указать 0 или не указывать данные параметр если самовывоз бесплатный;</li> <li>**days** (string) — время доставки товара на точку самовывоза, после которой товар можно забрать, 0 - если можно забрать в тот же день (возможно указать интервал “5-7”, который интерпретируется как “доставка на пункт выдачи от 5 до 7 дней”).</li></ul> |

### Обработка ошибок
> Пример ответа в JSON:

```json
{"errorFields":[
    {"price": "price is required"},
    {"offerId": "not found"}]
}
```
| Код HTTP | Описание |
|----------|---------------------------------------------------------------------------------|
| 5xx | Внутренняя ошибка сервера партнера. |
| 422 | Неверный формат запроса (указаны неверные или не указаны обязательные параметры запроса). В теле запроса необходимо передавать поля, которые переданы с ошибкой и указывать в чем она заключается.  Формулировка ошибки может быть произвольной строкой (см. пример). |



## → POST /order/:orderId/reserve
**Резервирование товара у партнера**<br>
После того, как покупатель заполнил заявку, выбрал способ доставки и его заявка была одобрена системой скоринга банка, партнеру приходит запрос на резервирование товара до момента подписания кредитного договора клиентом.
В заказе может быть любое число товаров, которые будут переданы в массивах запросов, описанных ниже, поэтому для примера используется случай, когда в массиве передано два товара.

### Входные параметры
`POST https://example.com/order/:orderId/reserve`

> Пример запроса POST /order/:orderId/reserve:

```shell
curl -X POST https://example.com/order/18022600000999/reserve \
  -H 'Content-Type: application/json' \
  -H 'cache-control: no-cache' \
  -d '{
  "orderId": "18022600000999", 
  "offerIds": [
    {
      "offerId": "123", 
      "quantity": 2, 
      "price": 19000.0,
      "priceTotal": 20000.0,
      "productCode": "0-0-6"
    },
    {
      "offerId": "456", 
      "quantity": 1, 
      "price": 10500.0,
      "priceTotal": 11000.0,
      "productCode": "0-0-12"
    }
    ], 
  "regionId": 77, 
  "pointId": "0",
  "DeliveryId": 7,
  "client": { "firstName": "Иван", "lastName": "Иванов", "phone": "1244567", "email":"test@test.ru" },
  "address": {"country": "Россия", "region": "Москва", "district": "", "town": "Москва", "locality": "", "street": "Обводного канала", "house": "199", "flat": "", "block": "", "building": "", "zipcode": "190020"}
}'
```

| Параметр | Обязательность | Описание |
|---------------------------------|----------------|--------------------------------------------------------------------------------------|
| `orderId`<br>  string | Обязательно | Идентификатор заказа, сгенерированный на стороне маркетплейса. |
| `offerIds`<br> Array of [{offer}](#offer-3)| Обязательно | Массив объектов с идентификаторами товаров и их количество. |
| `regionId`<br> integer | Обязательно | Идентификатор региона из списка. |
| `pointId`<br> string | Обязательно | Идентификатор точки самовывоза из CSV, 0 - если выбрана доставка курьером. |
| `DeliveryId`<br> integer  | Необязательно | Идентификатор службы доставки в системе партнера. |
| `address`<br> [{address}](#address)| Необязательно | Адрес в формате КЛАДР, указывается, если выбрана доставка курьером. |
| `client`<br> [{clientInfo}](#clientinfoubu)| Обязательно(для метода reserve) | Информация о клиенте. |
                       
**Объект offer**

| Параметр | Обязательность | Описание |
|------------------------|----------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `offerId`<br> string | Обязательно | Идентификатор товара из YML-каталога. |
| `quantity`<br> integer | Обязательно | Количество единиц товара. |
| `price`<br> float | Обязательно | Цена товара с учетом скидки, предоставляемой партнером. Размер скидки зависит от используемого кредитного продукта (срока рассрочки) и согласован с партнером. |
| `priceTotal`<br> float | Обязательно | Цена товара без учета скидки, то есть стоимость товара, которую партнер заявил в своем каталоге. |
| `productCode`<br> string | Необязательно | Код кредитного продукта (срок рассрочки).<br> Примеры:<ul><li>0-0-3</li><li>0-0-6</li><li>0-0-10</li><li>0-0-12</li><li>0-0-18</li><li>0-0-24</li><li>0-0-36</li></ul> |
 
**Объект address**

Столбец "Обязательность" в этой таблице указывает на элементы, которые могут содежаться в массиве адреса. В зависимости от введенного клиентом адреса, распознавание его и заполнение в теги может быть произвольным, просьба советоваться с сотрудниками интеграции при установке каких-либо проверок на обязательность тех или иных полей в этом массиве.

| Параметр | Обязательность | Описание |
|-----------------------|----------------|------------------|
| `country`<br>  string | Обязательно | Код страны по КЛАДР |
| `region`<br> string | Обязательно | Регион |
| `district`<br>string | Необязательно | Район |
| `town`<br>string | Необязательно | Город |
| `locality`<br>string | Необязательно | Населенный пункт |
| `street` <br>string | Обязательно | Улица |
| `house`<br> string | Обязательно | Дом |
| `flat` <br>string | Необязательно | Квартира |
| `block` <br>string | Необязательно | Корпус |
| `building` <br>string | Необязательно | Строение |
| `zipcode` <br>string | Обязательно | Индекс |

**Объект clientInfo**

| Параметр | Обязательность | Описание |
|------------------------|----------------|---------------------------------------------------|
| `firstName`<br>string | Обязательно | Имя клиента |
| `lastName`<br>string | Обязательно | Фамилия клиента |
| `middleName`<br>string | Необязательно | Отчество клиента |
| `email`<br>string | Необязательно | E-mail |
| `phone`<br>string | Обязательно | Номер телефона клиента (должен быть ровно 10 цифр, без кода страны) |

### Параметры ответа
`HTTP status code 200 OK — Оба товара зарезервированы.`

```json
{
   "orderId":"18022600000999",
   "PartnerOrderId":"17814",
   "offersResponse":[
      {
         "offerId":"123",
         "status":"reserved"
      },
      {
         "offerId":"456",
         "status":"reserved"
      }
   ]
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|------------------------------------------------------------|
| `orderId` <br>string | Обязательно | Идентификатор заказа, сгенерированный на стороне Маркетплейса |
| `PartnerOrderId` <br>string | Обязательно | Идентификатор заказа, сгенерированный на стороне партнера |
| `offerId`<br> string | Обязательно | Идентификатор товара из YML-каталога |
| `status`<br> string | Обязательно | значение: "reserved" |


`HTTP status code 200 OK — Один из товаров недоступен для резервирования.`

```json
{
   "orderId":"18022500002104",
   "PartnerOrderId":"17814",
   "offersResponse":[
      {
         "offerId":"123",
         "status":"reserved"
      },
      {
         "offerId":"456",
         "status":"cancelled",
         "reason":"not in stock"
      }
   ]
}

```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|------------------------------------------------------------------------------|
| `orderId` <br>string | Обязательно | Идентификатор заказа, сгенерированный на стороне Маркетплейса |
| `PartnerOrderId` <br>string | Обязательно | Идентификатор заказа, сгенерированный на стороне партнера |
| `offerId`<br> string | Обязательно | Идентификатор товара из YML-каталога |
| `status`<br> string | Обязательно | значение: 'cancelled' |
| `reason` <br>string | Обязательно | Причина отказа в резервировании (Пример: 'address is not in delivery area') |

`HTTP status code 200 OK — Оба товара недоступны для резервирования.`

```json
{
   "orderId":"18022500002104",
   "offersResponse":[
      {
         "offerId":"123",
         "status":"cancelled",
         "reason":"not in stock"
      },
      {
         "offerId":"456",
         "status":"cancelled",
         "reason":"not in stock"
      }
   ]
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|------------------------------------------------------------------------------|
| `orderId`<br>string | Обязательно | Идентификатор заказа, сгенерированный на стороне Маркетплейса |
| `offerId`<br> string | Обязательно | Идентификатор товара из YML-каталога |
| `status`<br> string | Обязательно | значение: 'cancelled' |
| `reason`<br>string | Обязательно | Причина отказа в резервировании (Пример: 'address is not in delivery area') |

### Обработка ошибок 
 > Пример ответа в JSON:
 
```json
{
   "errorFields":[
      {
         "clientInfo":{
            "phone":"phone is required"
         }
      }
   ]
}
```

| Параметр | Описание |
|----------|-----------------------------------|
| `5xx` | Внутренняя ошибка сервера партнера. |
| `422` | Неверный формат запроса (указаны неверные или не указаны обязательные параметры запроса).<br> В теле запроса необходимо передавать поля, которые переданы с ошибкой и указывать в чем она заключается. Формулировка ошибки может быть произвольной строкой (см. пример). |
| `404` | Заказ не существует или указан неверный идентификатор. |



## → POST /order/:orderId/status
**Передача статуса кредитной заявки партнера**

Данным методом Маркетплейс передает партнеру статус заявки в случае подписания(signed), что для партнера служит сигналом для доставки заказа клиенту или на пункт самовывоза. Либо отменяет заказ.

<aside class="notice">
Возможные сценарии:
</aside>

| Статус | Описание | Действия партнера |
|-------------------------------|----------------------------------------------------------------------|----------------------------------------------------------------------------------|
| Кредит отменен<br>(CANCELLED) | Отказ клиента. Также можно интерпретировать как отмена бронирования. | Партнер отменяет заказ. |
| Кредит подписан<br>(SIGNED) | Покупатель подписал кредитный договор и ожидает получение товара. | Партнер может выдать товар на пункте самовывоза, либо начинает процесс доставки. |


### Входные параметры
`POST https://example.com/order/:orderId/status`

> Пример запроса POST /order/:orderId/status:

```shell
curl -X POST \
  https://example.com/order/1234567890/status/ \
  -H 'Content-Type: application/json' \
  -H 'cache-control: no-cache' \
  -d '{
    "orderId":"1234567890",
    "PartnerOrderId":"777",
    "status":"SIGNED"
  }'
```
| Параметр | Обязательность | Описание |
|----------------------------|----------------|------------------------------------------------------------------------------------------------------------|
| `orderId`<br>string | Обязательно | Идентификатор заказа, сгенерированный на стороне Маркетплейс. |
| `PartnerOrderId`<br>string | Необязательно | Идентификатор заказа, сгенерированный на стороне партнера. Обязательный параметр, если партнер вернул этот параметр (номера заказа) на этапе резервирования. |
| `status`<br>string | Обязательно | Статус кредитной заявки (передается в качестве url-параметра).<br> Возможные варианты:<br><ul><li> CANCELLED - Кредит отменен.Отказ клиента.</li> <li>SIGNED - Кредит подписан.</li></ul> |

### Параметры ответа
`HTTP status code 200 OK —  Товар принят в обработку.`

> Примеры ответов в JSON:

```json
{
  "orderId": "18022600000999",
  "PartnerOrderId": "12345",
  "status": "reserved"
 
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|------------------------------------------------------------|
| `orderId`<br> string | Обязательно | Идентификатор заказа, сгенерированный на стороне маркетплейса |
| `PartnerOrderId` <br>string | Необязательно | Идентификатор заказа, сгенерированный на стороне партнера. |
| `status`<br> string | Обязательно | Значение: 'reserved' |





`HTTP status code 200 OK — Товар доставляется.`

```json
{
  "orderId": "18022600000999",
  "PartnerOrderId": "12345",
  "status": "delivering"
  
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|------------------------------------------------------------|
| `orderId`<br> string      | Обязательно  | Идентификатор заказа, сгенерированный на стороне маркетплейса |
| `PartnerOrderId` <br>string | Необязательно | Идентификатор заказа, сгенерированный на стороне партнера. |
| `status`<br> string | Обязательно | Значение: 'delivering'. |




`HTTP status code 200 OK — Товар не будет доставлен(Отмена заказа).`

```json
{
  "orderId": "18022600000999",
  "PartnerOrderId": "12345",
  "status": "cancelled",
  "reason": "address is not in delivery area"
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|-------------------------------------------------------------|
| `orderId`<br> string      | Обязательно  | Идентификатор заказа, сгенерированный на стороне маркетплейса |
| `PartnerOrderId` <br>string | Необязательно | Идентификатор заказа, сгенерированный на стороне партнера. |
| `status`<br> string | Обязательно | Значение: 'reserved' |
| `reason` <br> string | Обязательно | Причина отказа (Пример: 'address is not in delivery area'). |


### Обработка ошибок 
 > Пример ответа в JSON:
 
```json
{"errorFields":[
    {
      "status": "not valid status"
    } 
  ]
}
```

| Параметр | Описание |
|----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `5xx`  | Внутренняя ошибка сервера партнера. |
| `422` | Неверный формат запроса (указаны неверные или не указаны обязательные параметры запроса).<br> В теле запроса необходимо передавать поля, которые переданы с ошибкой и указывать в чем она заключается. Формулировка ошибки может быть произвольной строкой (см. пример). |
| `404` | Заказ не существует или указан неверный идентификатор. |



## → GET /order/:orderId
> Пример запроса GET /order/:orderId:

```shell
curl -X GET \
  https://example.com/order/1234567890 \
  -H 'cache-control: no-cache' \

```

`GET https://example.com/order/:orderId`

### Логика ответа

Возможные сценарии:

| Статус | Описания | Действия MarketPlace |
|----------------------------|---------------------------------------------------|---------------------------------------------------------------------------------|
| Товар зарезервирован (reserved) | Партнер подтвердил, что выбранный товар зарезервирован до момента подписания Покупателем Кредитного договора | MarketPlace отправляет договор на подписание (в случае курьерской доставки), либо готовит печатные формы договора (в случае подписания на торговой точке партнера). |
| Товар находится в процессе доставки (delivering) | Партнер сообщает, что товар находится в процессе доставки Покупателю. | MarketPlace ожидает получение финального статуса. |
| Товар доставлен (delivered) | Партнер сообщает, что товар доставлен/выдан Покупателю. | MarketPlace начинает процедуру взаиморасчета с партнером. |
| Заказ отклонен (cancelled) | Партнер сообщает, что заказ отклонен. Дополнительно указывает причину отказа в поле reason. | MarketPlace отклоняет заказ внутри своей базы данных, информирует Покупателя об отмене. |

<aside class="warning">
После того как партнеру пришел статус SIGNED, отменить заказ в автоматическом режиме невозможно, т.к. у клиента уже на руках подписанный кредитный договор, который необходимо аннулировать через клиентскую поддержку Marketplace.<br>
Для этого необходимо:
<ul><li>Обратиться в поддержку Marketplace по почте <a href="mailto:mpsupport@homecredit.ru">mpsupport@homecredit.ru</a>, указав в письме номер кредитного договора (можно узнать в партнерском ЛК), и причину аннулирования договора</li><li>Отправлять корректный ответ на метод GET /order/:orderId: с "status": "cancelled" и указанием причины в поле "reason"</li><li>Если отмена заказа происходит по инициативе партнера, то необходимо связаться с клиентом и уведомить его об отмене.</li></ul>
</aside>

###Параметры ответа
`HTTP status code 200 OK — Товар зарезервирован.`
 
```json
{
    "orderId": "18022600000999",
    "status": "reserved",
    "PartnerOrderId": "12345"
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `orderId`<br> string | Обязательно  | Идентификатор заказа, сгенерированный на стороне Маркетплейс.| 
| `status`<br> string | Обязательно | Значение: 'reserved' |
| `PartnerOrderId`<br> string | Необязательно  | Идентификатор заказа, сгенерированный на стороне партнера. Обязательный параметр, если партнер вернул этот параметр (номера заказа) на этапе резервирования |

`HTTP status code 200 OK — Товар доставляется.`
 
```json
{
    "orderId": "18022600000999",
    "status": "delivering",
    "PartnerOrderId": "12345",
    "trackId": "TK456789"
}
```
| Параметр | Обязательность | Описание |
|-----------------------------|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `orderId`<br> string | Обязательно  | Идентификатор заказа, сгенерированный на стороне Маркетплейс.| 
| `status`<br> string | Обязательно | Значение: 'delivering' |
| `PartnerOrderId`<br> string | Необязательно  | Идентификатор заказа, сгенерированный на стороне партнера. Обязательный параметр, если партнер вернул этот параметр (номера заказа) на этапе резервирования |
| `trackId`<br> string | Необязательно | Id для трэкинга заказа, доставляемого транспортной компанией |

`HTTP status code 200 OK — Заказ доставлен.`
 
```json
{
    "orderId": "18022600000999",
    "status": "delivered",
    "PartnerOrderId": "12345"
}
```
| Параметр | Обязательность | Описание |
|-----------------------------|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `orderId`<br> string | Обязательно  | Идентификатор заказа, сгенерированный на стороне Маркетплейс.| 
| `status`<br> string | Обязательно | Значение: 'delivered' |
| `PartnerOrderId`<br> string | Необязательно  | Идентификатор заказа, сгенерированный на стороне партнера. Обязательный параметр, если партнер вернул этот параметр (номера заказа) на этапе резервирования |

`HTTP status code 200 OK — Заказ отклонен.`

```json
{
    "orderId": "18022600000999",
    "status": "cancelled",
    "reason": "not in stock",
    "PartnerOrderId": "12345"
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `orderId`<br> string | Обязательно  | Идентификатор заказа, сгенерированный на стороне Маркетплейс.| 
| `status`<br> string | Обязательно | Значение: 'cancelled' |
| `PartnerOrderId`<br> string | Необязательно  | Идентификатор заказа, сгенерированный на стороне партнера. Обязательный параметр, если партнер вернул этот параметр (номера заказа) на этапе резервирования |
| `reason` <br> string | Обязательно | причина отказа (Пример: 'not in stock') |

### Обработка ошибок 
 > Пример ответа в JSON:
 
```json
{"errorFields":[
    {
      "status": "not valid Id"
    } 
  ]
}
```

| Код HTTP | Описание |
|----------|--------------------------------------------------------|
| 5xx | Внутренняя ошибка сервера партнера. |
| 404 | Заказ не существует или указан неверный идентификатор. |



# API версии 1.0 (устаревшее)

<aside class="warning">
Описание этих методов приводится ТОЛЬКО ДЛЯ ОЗНАКОМЛЕНИЯ. Текущая реализация все еще поддерживает их, но вскоре будет отключена. Настоятельно рекомендуется использование методов версий 2.0 и выше.
</aside>

## POST /order/check/
**Проверка наличия товара у партнера.**<br>
В момент когда Покупатель выбрал предложение, партнеру поступает запрос на проверку наличия данного товара в регионе. В ответ партнер должен уведомить о возможности зарезервировать товар, а также прислать условия доставки и самовывоза. Расчет параметров получения товара клиентом должен производиться на основе доступных товаров. (Например, если доступно только 3 из 5 переданных в запросе товаров, стоимость доставки должна быть только для этих трех товаров).

### Входные параметры
`POST https://example.com/order/check/`
> Пример запроса POST /order/check/:

```shell
curl -X POST https://example.com/order/check/ \
  -H 'Content-Type: application/json' \
  -H 'cache-control: no-cache' \
  -d '{"offersRequest":[
{"offerId":"123",
"quantity":1,
"regionId":77,
"productCode":"0-0-6"}
]}'
```

| Параметр                                     | Обязательность | Описание                                                                           |
|----------------------------------------------|----------------|------------------------------------------------------------------------------------|
| `offersRequest`<br>  Array of [{offerRequest}](#offerrequest) | Обязательно    | Массив объектов с запросами на проверку наличия товаров, которые выбрал Покупатель. |

**Объект offerRequest**

| Параметр                 | Обязательность | Описание                                                                                                           |
|--------------------------|----------------|--------------------------------------------------------------------------------------------------------------------|
| `offerId` <br> string    | Обязательно    | Идентификатор товара из YML-каталога |
| `quantity`<br>integer    | Обязательно    | Количество единиц товара для бронирования |
| `regionId` <br>integer   | Обязательно    | Идентификатор региона |
| `productCode`<br> string | Обязательно    | Код кредитного продукта.<br> Примеры:<ul><li>0-0-3</li><li>0-0-6</li><li>0-0-10</li><li>0-0-12</li><li>0-0-18</li><li>0-0-24</li><li>0-0-36</li></ul> |


### Параметры ответа
`HTTP status code 200 OK — Список товаров с указанием наличия и условий.`
> Пример ответа в JSON:

```json
{
    "offersResponse": [
        {
            "status": "available",
            "offerId": "123",
            "quantity": 1,
            "points": [
                "0"
            ]
        }
    ],
    "DeliveryOptions": {
        "delivery": [
            {
                "DeliveryID": 1,
                "DeliveryName": "Доставка СДЭК(склад-склад)",
                "Cost": 1000,
                "Days": "1-2"
            }
        ]
    }
}
```

| Параметр | Обязательность | Описание |
|-------------------------------------------|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| offersResponse Array of [{offerResponse}](#offerresponse)| Обязательно | Массив объектов со статусом резерва по каждому из запрошенных товаров. |
| DeliveryOptions [{DeliveryOption}](#deliveryoption)| Обязательно | Дополнительная информация по параметрам доставки, которую сможет выбирать Покупатель. Партнер должен представить варианты доставки для всей группы товаров. |

**Объект offerResponse**

| Параметр | Обязательность | Описание |
|------------------------------|----------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `offerId`<br>integer | Обязательно | Идентификатор товара из YML-каталога. |
| `status`<br>string | Обязательно | Варианты:<ul><li>‘available’ — товар доступен;</li><li>‘unavailable’ — товар недоступен.</li></ul> |
| `quantity`<br>integer | Обязательно | Доступное количество товара. |
| `points`<br> Array of string | Обязательно | Идентификаторы пунктов самовывоза, в которых доступен товар.<br>Также необходимо добавлять в список 0, если доступна доставка курьером. Пустой массив - товар недоступен. |
| `reason`<br>string | Необязательно | Указывается, если товар недоступен (пример: “not in stock”). |

**Объект DeliveryOption**

| Параметр | Обязательность | Описание  |
|---------------------------------|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `delivery`<br> Array of Objects | Необязательно | Список вариантов доставки с указанием параметров: <ul><li>deliveryId—идентификатор службы доставки в системе партнера (будет передано при резервировании заказа);</li> <li>deliveryName— название службы доставки (будет отображено Покупателю);</li> <li>cost— стоимость доставки (если параметр отсутствует, то стоимость необходимо уточнять у службы доставки);</li><li> days— время доставки в днях (возможно указать интервал, например “5-7” интерпретируется как “доставка от 5 до 7 дней”).</li></ul>|
| `pickup`<br> Array of Objects | Необязательно | Список точек самовывоза доступные для заказа с указанием параметров:<ul><li> point — идентификатор точки самовывоза из CSV;</li> <li>cost— стоимость за услугу самовывоза, можно указать 0 или не указывать данные параметр если самовывоз бесплатный;</li> <li>days — время доставки товара на точку самовывоза, после которой товар можно забрать, 0 - если можно забрать в тот же день (возможно указать интервал, например “5-7” интерпретируется как “доставка от 5 до 7 дней”).</li></ul> |

### Обработка ошибок
> Пример ответа в JSON:

```json
{"errorFields":[
    {"price": "price is required"},
    {"offerId": "not found"}]
}
```
| Код HTTP | Описание |
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 5xx | Внутренняя ошибка сервера партнера. |
| 422 | Неверный формат запроса (указаны неверные или не указаны обязательные параметры запроса). В теле запроса необходимо передавать поля, которые переданы с ошибкой и указывать в чем она заключается.  Формулировка ошибки может быть произвольной строкой (см. пример). |



## POST /order/:orderId/reserve
**Резервирование товара у партнера**<br>
После того, как Покупатель заполнил заявку, выбрал способ доставки и его заявка была одобрена системой скоринга банка, партнеру приходит запрос на резервирование товара до момента подписания кредитного договора клиентом.

###Входные параметры
`POST https://example.com/order/:orderId/reserve`

> Пример запроса POST /order/:orderId/reserve:

```shell
curl -X POST https://example.com/order/18022500002104/reserve \
  -H 'Content-Type: application/json' \
  -H 'cache-control: no-cache' \
  -d '{
  "orderId": "18022500002104", 
  "offerIds": [
    {
      "offerId": 777, 
      "quantity": 1, 
      "price": 4000.0,
      "priceTotal": 5000.0
    }
    ], 
  "regionId": 77, 
  "pointId": "0",
  "DeliveryId": 7,
  "productCode": "0-0-3",
  "client": { "firstName": "Иван", "lastName": "Иванов", "phone": "1244567", "email":"test@test.ru" },
  "address": {"country": "Россия", "region": "Москва", "district": "", "town": "Москва", "locality": "", "street": "Обводного канала", "house": "199", "flat": "", "block": "", "building": "", "zipcode": "190020"}
}'
```

| Параметр | Обязательность | Описание |
|---------------------------------|----------------|--------------------------------------------------------------------------------------|
| `orderId`<br>  string | Обязательно | Идентификатор заказа, сгенерированный на стороне маркетплейса. |
| `offerIds`<br> Array of [{offer}](#offer-3)| Обязательно | Массив объектов с идентификаторами товаров и их количество. |
| `regionId`<br> integer | Обязательно | Идентификатор региона из списка. |
| `pointId`<br>string | Обязательно | Идентификатор точки самовывоза из CSV, 0 - если выбрана доставка курьером. |
| `DeliveryId`<br>integer  | Необязательно | Идентификатор службы доставки в системе партнера. |
| `productCode`<br>string  | Обязательно | Код кредитного продукта.<br> Примеры:<ul><li>0-0-3</li><li>0-0-6</li><li>0-0-10</li><li>0-0-12</li><li>0-0-18</li><li>0-0-24</li><li>0-0-36</li></ul> |
| `address`<br> [{address}](#address)| Необязательно | Адрес в формате КЛАДР, указывается, если выбрана доставка курьером. |
| `client`<br> [{clientInfo}](#clientinfoubu)| Обязательно(для метода reserve) | Информация о клиенте. |
                           
**Объект offer**

| Параметр | Обязательность | Описание |
|------------------------|----------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `offerId`<br> integer | Обязательно | Идентификатор товара из YML-каталога. |
| `quantity`<br> integer | Обязательно | Количество единиц товара. |
| `price`<br> float | Обязательно | Цена товара с учетом скидки, предоставляемой партнером. Размер скидки зависит от используемого тарифа (срока рассрочки) и согласован с партнером. |
| `priceTotal`<br> float | Обязательно | Цена товара без учета скидки, то есть стоимость товара, которую партнер заявил в своем каталоге. |
 
**Объект address**

| Параметр | Обязательность | Описание |
|-----------------------|----------------|----------------------|
| `country`<br>  string | Обязательно | Код страны по КЛАДР. |
| `region`<br> string | Обязательно | Регион. |
| `district`<br>string | Обязательно | Район. |
| `town`<br>string | Обязательно | Город. |
| `locality`<br>string | Обязательно | Населенный пункт. |
| `street` <br>string | Обязательно | Улица. |
| `house`<br> string | Обязательно | Дом. |
| `flat` <br>string | Необязательно | Квартира. |
| `block` <br>string | Необязательно | Корпус. |
| `building` <br>string | Необязательно | Строение. |
| `zipcode` <br>string | Обязательно | Индекс. |

**Объект clientInfo**

| Параметр | Обязательность | Описание |
|------------------------|----------------|---------------------------------------------------|
| `firstName`<br>string | Обязательно | Имя клиента. |
| `lastName`<br>string | Обязательно | Фамилия клиента. |
| `middleName`<br>string | Необязательно | Отчество клиента. |
| `email`<br>string | Необязательно | E-mail. |
| `phone`<br>string | Обязательно | Телефон клиента. Номер должен быть ровно 10 цифр. |

### Параметры ответа
`HTTP status code 200 OK — Товар зарезервирован(ответ на метод reserve).`

```json
{
"orderId": "18022600000999",
"status": "reserved",
"PartnerOrderId": "12345"
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|------------------------------------------------------------|
| `orderId` <br>string | Обязательно | Идентификатор заказа, сгенерированный на стороне Маркетплейса. |
| `status`<br> string | Обязательно | значение: "reserved" |
| `PartnerOrderId` <br>string | Необязательно | Идентификатор заказа, сгенерированный на стороне партнера. |


`HTTP status code 200 OK — Товар недоступен для резервирования.`

```json
{
"orderId": "18022600000999",
"status": "cancelled",
"reason": "not in stock"
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|------------------------------------------------------------------------------|
| `orderId` <br>string | Обязательно | Идентификатор заказа, сгенерированный на стороне Маркетплейса. |
| `status`<br> string | Обязательно | значение: 'cancelled'. |
| `reason` <br>string | Обязательно | Причина отказа в резервировании (Пример: 'address is not in delivery area'). |
| `PartnerOrderId` <br>string | Необязательно | Идентификатор заказа, сгенерированный на стороне партнера. |

### Обработка ошибок 
 > Пример ответа в JSON:
 
```json
{"errorFields":[
      {"clientInfo": 
        {
        "phone": "phone is required"
        }
      }
  ]
}
```

| Параметр | Описание |
|----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `5xx`  | Внутренняя ошибка сервера партнера. |
| `422` | Неверный формат запроса (указаны неверные или не указаны обязательные параметры запроса).<br> В теле запроса необходимо передавать поля, которые переданы с ошибкой и указывать в чем она заключается. Формулировка ошибки может быть произвольной строкой (см. пример). |
| `404` | Заказ не существует или указан неверный идентификатор. |



## POST /order/:orderId/status
**Передача статуса кредитной заявки партнера**

Данным методом Маркетплейс передает партнеру статус заявки в случае подписания(signed), что для партнера служит сигналом для доставки заказа клиенту или на пункт самовывоза. Либо отменяет заказ.

<aside class="notice">
Возможные сценарии:
</aside>

| Статус | Описание | Действия партнера |
|-------------------------------|----------------------------------------------------------------------|----------------------------------------------------------------------------------|
| Кредит отменен<br>(CANCELLED) | Отказ клиента. Также можно интерпретировать как отмена бронирования. | Партнер отменяет заказ. |
| Кредит подписан<br>(SIGNED) | Покупатель подписал кредитный договор и ожидает получение товара. | Партнер может выдать товар на пункте самовывоза, либо начинает процесс доставки. |


### Входные параметры
`POST https://example.com/order/:orderId/status`

> Пример запроса POST /order/:orderId/status:

```shell
curl -X POST \
  https://example.com/order/1234567890/status/ \
  -H 'Content-Type: application/json' \
  -H 'cache-control: no-cache' \
  -d '{
    "orderId":"1234567890",
    "PartnerOrderId":"777",
    "status":"SIGNED"
  }'
```
| Параметр | Обязательность | Описание |
|----------------------------|----------------|------------------------------------------------------------------------------------------------------------|
| `orderId`<br>string | Обязательно | Идентификатор заказа, сгенерированный на стороне Маркетплейс. |
| `PartnerOrderId`<br>string | Необязательно | Идентификатор заказа, сгенерированный на стороне партнера. Обязательный параметр, если партнер вернул этот параметр (номера заказа) на этапе резервирования. |
| `status`<br>string | Обязательно | Статус кредитной заявки (передается в качестве url-параметра).<br> Возможные варианты:<br><ul><li> CANCELLED - Кредит отменен.Отказ клиента.</li> <li>SIGNED - Кредит подписан.</li></ul> |

### Параметры ответа
`HTTP status code 200 OK —  Товар принят в обработку.`

> Примеры ответов в JSON:

```json
{
  "orderId": "18022600000999",
  "PartnerOrderId": "12345",
  "status": "reserved"
 
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|------------------------------------------------------------|
| `orderId`<br> string | Обязательно | Идентификатор заказа, сгенерированный на стороне маркетплейса |
| `PartnerOrderId` <br>string | Необязательно | Идентификатор заказа, сгенерированный на стороне партнера. |
| `status`<br> string | Обязательно | Значение: 'reserved' |



### Обработка ошибок 
 > Пример ответа в JSON:
 
```json
{"errorFields":[
    {
      "status": "not valid status"
    } 
  ]
}
```

| Параметр | Описание |
|----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `5xx`  | Внутренняя ошибка сервера партнера. |
| `422` | Неверный формат запроса (указаны неверные или не указаны обязательные параметры запроса).<br> В теле запроса необходимо передавать поля, которые переданы с ошибкой и указывать в чем она заключается. Формулировка ошибки может быть произвольной строкой (см. пример). |
| `404` | Заказ не существует или указан неверный идентификатор. |



## GET /order/:orderId
> Пример запроса GET /order/:orderId:

```shell
curl -X GET \
  https://example.com/order/1234567890 \
  -H 'cache-control: no-cache' \

```

`GET https://example.com/order/:orderId`

### Логика ответа

Возможные сценарии:

| Статус | Описания | Действия MarketPlace |
|----------------------------|---------------------------------------------------|---------------------------------------------------------------------------------|
| Товар зарезервирован (reserved) | Партнер подтвердил, что выбранный товар зарезервирован до момента подписания Покупателем Кредитного договора | MarketPlace отправляет договор на подписание (в случае курьерской доставки), либо готовит печатные формы договора (в случае подписания на торговой точке партнера). |
| Товар находится в процессе доставки (delivering) | Партнер сообщает, что товар находится в процессе доставки Покупателю. | MarketPlace ожидает получение финального статуса. |
| Товар доставлен (delivered) | Партнер сообщает, что товар доставлен/выдан Покупателю. | MarketPlace начинает процедуру взаиморасчета с партнером. |
| Заказ отклонен (cancelled) | Партнер сообщает, что заказ отклонен. Дополнительно указывает причину отказа в поле reason. | MarketPlace отклоняет заказ внутри своей базы данных, информирует Покупателя об отмене. |

<aside class="warning">
После того как партнеру пришел статус SIGNED, отменить заказ в автоматическом режиме невозможно, т.к. у клиента уже на руках подписанный кредитный договор, который необходимо аннулировать через клиентскую поддержку Marketplace.<br>
Для этого необходимо:
<ul><li>Обратиться в поддержку Marketplace по почте <a href="mailto:mpsupport@homecredit.ru">mpsupport@homecredit.ru</a>, указав в письме номер кредитного договора (можно узнать в партнерском ЛК), и причину аннулирования договора</li><li>Отправлять корректный ответ на метод GET /order/:orderId: с "status": "cancelled" и указанием причины в поле "reason"</li></ul>
</aside>

###Параметры ответа
`HTTP status code 200 OK — Товар зарезервирован.`
 
```json
{
    "orderId": "18022600000999",
    "status": "reserved",
    "PartnerOrderId": "12345"
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `orderId`<br> string | Обязательно  | Идентификатор заказа, сгенерированный на стороне Маркетплейс.| 
| `status`<br> string | Обязательно | Значение: 'reserved' |
| `PartnerOrderId`<br> string | Необязательно  | Идентификатор заказа, сгенерированный на стороне партнера. Обязательный параметр, если партнер вернул этот параметр (номера заказа) на этапе резервирования |

`HTTP status code 200 OK — Товар доставляется.`
 
```json
{
    "orderId": "18022600000999",
    "status": "delivering",
    "PartnerOrderId": "12345",
    "trackId": "TK456789"
}
```
| Параметр | Обязательность | Описание |
|-----------------------------|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `orderId`<br> string | Обязательно  | Идентификатор заказа, сгенерированный на стороне Маркетплейс.| 
| `status`<br> string | Обязательно | Значение: 'delivering' |
| `PartnerOrderId`<br> string | Необязательно  | Идентификатор заказа, сгенерированный на стороне партнера. Обязательный параметр, если партнер вернул этот параметр (номера заказа) на этапе резервирования |
| `trackId`<br> string | Необязательно | Id для трэкинга заказа, доставляемого транспортной компанией |

`HTTP status code 200 OK — Заказ доставлен.`
 
```json
{
    "orderId": "18022600000999",
    "status": "delivered",
    "PartnerOrderId": "12345"
}
```
| Параметр | Обязательность | Описание |
|-----------------------------|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `orderId`<br> string | Обязательно  | Идентификатор заказа, сгенерированный на стороне Маркетплейс.| 
| `status`<br> string | Обязательно | Значение: 'delivered' |
| `PartnerOrderId`<br> string | Необязательно  | Идентификатор заказа, сгенерированный на стороне партнера. Обязательный параметр, если партнер вернул этот параметр (номера заказа) на этапе резервирования |

`HTTP status code 200 OK — Заказ отклонен.`

```json
{
    "orderId": "18022600000999",
    "status": "cancelled",
    "reason": "not in stock",
    "PartnerOrderId": "12345"
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `orderId`<br> string | Обязательно  | Идентификатор заказа, сгенерированный на стороне Маркетплейс.| 
| `status`<br> string | Обязательно | Значение: 'cancelled' |
| `PartnerOrderId`<br> string | Необязательно  | Идентификатор заказа, сгенерированный на стороне партнера. Обязательный параметр, если партнер вернул этот параметр (номера заказа) на этапе резервирования |
| `reason` <br> string | Обязательно | причина отказа (Пример: 'not in stock') |

### Обработка ошибок 
 > Пример ответа в JSON:
 
```json
{"errorFields":[
    {
      "status": "not valid Id"
    } 
  ]
}
```

| Код HTTP | Описание |
|----------|--------------------------------------------------------|
| 5xx | Внутренняя ошибка сервера партнера. |
| 404 | Заказ не существует или указан неверный идентификатор. |

<aside class="warning">
В случае возникновения ошибки 5хх произойдет повторный запрос через 60 секунд, если ошибка повторится, партнеру перестанут поступать новые заказы. После пяти попыток с интервалом в минуту партнеру будет направлено email-уведомление о неполадках на его стороне, после чего партнер будет отключен от системы до тех пор, пока не сообщит о том, что работоспособность восстановлена.
</aside>