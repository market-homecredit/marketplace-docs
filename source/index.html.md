---
title: Markeplace_HC

language_tabs: # must be one of https://git.io/vQNgJ
  - shell


toc_footers:

  - <a href='https://market.homecredit.ru'>Маркетплейс Home Credit</a>

includes:
  - errors
search: false
---

#Общие положения
**Добро пожаловать на страницу интеграции с Маркетплейсом Хоум Кредит!**

На этой странице содержатся требования к выгружаемому каталогу товаров и сервису API, который необходимо реализовать партнеру при осуществлении интеграции с Маркетплейсом.

Так же, здесь детально описан жизненный путь заказа от момента выбора клиентом товара и до момента взаиморасчета с партнером.

<aside class="notice">
Доступ в Личный кабинет партнера (далее ЛК) предоставляется после запуска, по согласованию с менеджером. Реквизиты доступа высылаются на заявленный адрес электронной почты (e-mail).
</aside>

#Предоставление каталога 

Базовый сценарий предполагает, что на каждый регион необходимо задать свой каталог.

Возможен вариант, когда каталог товаров един для всех регионов, данный сценарий необходимо предварительно согласовать с менеджером.

<aside class="warning">
Партнер предоставляет каталог товаров в формате XML.
</aside> 

##Описание параметров выгрузки

Ниже описаны основные параметры для выгрузки каталога. Для успешной синхронизации каталога в нем должны присутствовать все обязательные параметры, а также соблюдаться структура выбранного формата.

Выгруженный каталог может содержать в себе любые другие параметры и элементы, например, всю структуру YML (стандарт, разработанный Яндексом для принятия и размещения информации в базе данных Яндекс.Маркета), что не будет вызывать ошибок обработки каталога со стороны Маркетплейс.

##Каталог в формате XML
> Пример выгрузки:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<yml_catalog date="2018-01-29 12:56">
    <shop>
        <name>Online Retail Company</name>
        <company>Online Retail Company</company>
        <url>https://online-retail-company.com</url>
        <categories>
            <category id="1">Ноутбуки</category>
            <category id="2" parentId="1">Планшеты</category>
            <category id="8" parentId="1">Смартфоны</category>
        </categories>
        <offers>
            <offer id="42" available="true" credit="list">
                <price>109999</price>
                <url>https://online-retail-company.com/shop/kompyuternaya-technika/noutbuki/42</url>
                <credits>
                    <credit program="0-0-24"/>
                    <credit program="0-0-12"/>
                    <credit program="0-0-3"/>
                </credits>
                <pickup>true</pickup>
                <delivery>true</delivery>
                <points>
                    <point id="2"/>
                    <point id="3"/>
                    <point id="5"/>
                    <point id="7"/>
                    <point id="9"/>
                </points>
                <delivery-options>
                    <option deliveryId="1" cost="338" days="2-3"/>
                    <option deliveryId="2" cost="979" days="3"/>
                    <option deliveryId="3" cost="488" days="5"/>
                </delivery-options>
                <categoryId>8</categoryId>
                <name>Ноутбук Apple MacBook Pro 15,4" with Touch Bar 2,6GHz/16Gb/512GbSSD/Radeon Pro 560X/MacOS Silver (MR972RU/A)</name>
                <description>
                  Процессоры высокой производительности, память большего объёма, передовая графика, 
                  сверхбыстрые накопители и другие впечатляющие способности MacBook Pro помогут вам воплощать в 
                  жизнь любые творческие проекты — ещё быстрее, чем раньше.
                </description>
            </offer>
            <offer id="262" available="true">
                <price>32499</price>
                <url>https://online-retail-company.com/shop/mobilnaya-technika/tablets/262</url>
                <pickup>true</pickup>
                <delivery>false</delivery>
                <points>
                    <point id="2"/>
                    <point id="3"/>
                    <point id="4"/>
                    <point id="5"/>
                    <point id="6"/>
                    <point id="7"/>
                    <point id="8"/>
                    <point id="10"/>
                </points>
                <categoryId>2</categoryId>
                <name>Планшет Apple iPad Pro 12.9 (2018) Wi-Fi 1Tb Space Gray (MTFR2RU/A)</name>
                <description>
                  Это iPad Pro с абсолютно новым дизайном и самыми продвинутыми технологиями Apple. 
                  Он меняет все представления об iPad. Новый iPad Pro с дисплеем от края до края просто волшебен: 
                  он справится со всеми вашими задачами, при этом его можно повернуть, как вам удобно.
                </description>
            </offer>
        </offers>
    </shop>
</yml_catalog>
```

Каталог обязательно должен иметь XML-заголовок, который начинается с первой строки, с нулевого элемента, в заголовке присутствуют атрибуты версии и используемая кодировка. Допустимые кодировки – UTF-8 или windows-1251. Пример заголовка: <?xml version="1.0" encoding="UTF-8"?>

За основу предложенной структуры XML-каталога использован формат выгрузки от [Яндекс.Маркет](https://yandex.ru/support/partnermarket/export/vendor-model.html), соответственно, если уже существует синхронизация с платформой Яндекс, достаточно внести незначительные дополнения, чтобы целевую выгрузку можно было задействовать для платформы Marketplace.

<aside class="warning">Цена товара в фиде должна соответствовать цене на сайте партнера.</aside>

| Элемент|Описание |
|-----------------------------|--------------------------------------------------------------------------------------|
| `yml_catalog`<br>Обязательный |  Корневой элемент, содержит в себе единственный параметр (является атрибутом для XML) date, который является обязательным и должен  соответствовать дате и времени генерации каталога, формат: “ YYYY-MM-DD hh:mm”, например "2017-02-06 17:19". Каталог может содержать только один корневой элемент. |

###Элементы yml_catalog
| Элемент| Описание |
|-------------------------|--------------------------------------------------------------------------------------|
| `shop`<br> Обязательный | Элемент содержит в себе описание партнерского магазина и его предложений. |


###Элементы shop
| Элемент| Описание |
|-------------------------|--------------------------------------------------------------------------------------|
| `name`<br> Обязательный |Короткое описание магазина партнера (не более 20 символов). |
| `company`<br> Обязательный | Полное наименование компании партнера (не публикуется на сайте). |
| `url`<br> Обязательный| URL главной страницы магазина партнера. |
| `categories`  <br> Обязательный| Состоит из списка элементов [category](#category), каждый из которых описывает категорию для товаров в каталоге. |
| `offers`<br> Обязательный|  Состоит из списка элементов [offer](#offer),  каждый из которых описывает товар в каталоге. |

###Атрибуты category
| Атрибут| Описание |
|-------------------------|--------------------------------------------------------------------------------------|
| `id` <br> Обязательный | Идентификатор категорий. |
| `parentId`<br> Необязательный | Идентификатор подкатегории. |


###Атрибуты offer

| Атрибут| Описание |
|-------------------------|--------------------------------------------------------------------------------------|
| `id`<br> Обязательный | Идентификатор товарного предложения. Доступные символы: латиница, цифры, дефисы. Длина - до 36 символов включительно. |
| `available`<br> Обязательный| Признак наличия товара. Возможные значения:<ul><li>true — товар доступен для бронирования;</li><li>false — недоступен для бронирования (нет в наличии).</li></ul> |
| `credit`<br> Обязательный, если предложение доступно в рассрочку |Признак, что товар продается в рассрочку. Возможные значения:<ul><li>list — признак, что для данного товара существует ограниченный список программ рассрочек, которые будут описаны в параметре credits;</li><li>Отсутствие данного признака означает, что данный товар недоступен для продажи рассрочку.</li></ul>|

<aside class="warning">Каждый offerID должен принадлежать товару, которому он был присвоен изначально! Нельзя присваивать новым товарам offerID, который ранее был присвоен другому товару, в противном случае оффер деактивируется. Это правило работает и в обратную сторону – если поменять у существующего оффера значение в теге name, этот оффер так же деактивируется!</aside>

###Элементы offer
| Элементы| Описание |
|-------------------------|--------------------------------------------------------------------------------------|
| `url`<br>  Необязательный | URL страницы товара на сайте партнера. |
| `price`<br> Обязательный | Цена товара на основе которой будет рассчитан ежемесячный платеж для рассрочки. |
| `credits`<br>Обязательный, если был заявлен атрибут credit со значением list | Включает список элементов программ рассрочек [credit](#credit), описывает доступные кредитные программы для каждого из товаров |
| `pickup`<br> Обязательный|  Обозначает доступность в пунктах самовывоза. Возможные значения:<ul><li>true — товар доступен в пунктах самовывоза. Дополнительно необходимо указать список пунктов самовывоза в параметре  points;</li><li>false — товар недоступен в пунктах самовывоза.</li></ul>  |
| `delivery` <br> Обязательный| Обозначает возможность доставки. Возможные значения:<ul><li>true — товар доступен для доставки;</li><li>false — доставка товара не предусмотрена.</li></ul>  |
| `points`<br>  Обязательный, если был заявлен элемент pickup со значением true | Состоит из элементов пунктов самовывоза и описывает доступные пункты самовывоза для получения данного предложения. |
| `delivery-options` <br> Необязательный| Параметр содержит список сроков и стоимости доставки для данного товара. Родительский элемент для [option](#option).|
| `categoryId` <br> Необязательный| Идентификатор категории товара для данного предложения|
| `name` <br> Обязательный| Название товара, не более 120 символов. Может содержать в себе название товара, производитель или бренд, модель, а также любые другие важные элементы.|
| `model` <br>  Необязательный| Наименование модели товара. (В случае, если каталог выгружается с платформы Bitrix, и тег name не подтягивается, то наименование будет взято из тега model.)|
| `vendor` <br>  Необязательный| Имя производителя или бренда для товара.|
| `description` <br>  Необязательный| Произвольное описание товара. Не более 3000 символов.|

<aside class="warning">На данный момент на Маркетплейсе действует верхняя и нижняя граница цены товаров, которые выводятся в каталог. Нижняя граница – 10000 р. (с учетом скидки), верхняя – 150000 р. (с учетом скидки). Ограничения будут сняты, с внедрением на Маркетплейс корзины товаров.</aside>

###Требования для тега &lt;name&gt;
Тег &lt;name&gt; содержит в себе название товара, которое будет выведено в названии карточки товара на платформе Marketplace и, в соответствии с требованиями отдела контента, должно иметь определенную структуру.
<br>

Обязательные составляющие тега &lt;name&gt;:

* название категории
* вендор
* модель
* важная особенность (На примере кровати: с механизмом, с матрасом, ящик для белья, и т.д.)
* цвет
* артикул вендора (при наличии)

![](name_offers.jpg)

###Атрибуты credit
| Атрибут| Описание |
|-------------------------|--------------------------------------------------------------------------------------|
| `program`<br> Обязательный |Вариант рассрочки для данного предложения. Возможные значения:<ul><li>0-0-3</li><li>0-0-6</li><li>0-0-10</li><li>0-0-12</li><li>0-0-18</li><li>0-0-24</li><li>0-0-36.</li></ul> |

###Атрибуты option
| Атрибут| Описание |
|-------------------------|--------------------------------------------------------------------------------------|
| `deliveryId`<br> Необязательный | Идентификатор доставки. Обязательный параметр, если доступно несколько вариантов доставки. |
| `cost`<br> Обязательный | Стоимость доставки. |
| `name`<br> Необязательный | Наименование варианта доставки. |
| `days`<br> Необязательный | Срок доставки в рабочих днях. Возможен вариант указания периодов доставки, например, “3-5” — от 3-х до 5 дней. Если указано пустое значение или атрибут не задан, считается, что срок доставки не определен. |
| `order-before`<br>  Необязательный| Время оформления заказа, до наступления которого действуют указанные сроки и условия доставки. В атрибуте указывается локальное время (в часовом поясе магазина). В качестве значения можно использовать только целое число от 0 до 24. Например, время 14:00 описывается следующим образом:order-before="14". Если атрибут не указан, по-умолчанию используется значение 24 (полночь). |

Если товар есть не во всех точках самовывоза или существует техническое ограничение на перевозку товаров из одного пункта в другой, предусмотрен формат указания списка точек самовывоза для отдельно взятого товара, для этого необходимо использовать параметр points и перечислить в нем точки самовывоза:

Список точек самовывоза партнер загружает через Личный кабинет, данный процесс описан в разделе [Точки самовывоза](#44b7115d87)

#Регионы покрытия
 
Название города в регионе покрытия означает и сам город, и область/район в котором он является административным центром.
В файле прописаны:
<ul><li>тип населенного пункта (у нас для обозначения используется город-административный центр региона)</li><li>название</li><li>regionId, который мы передаем в методах check и reserve для проверки наличия товара в выбранном пользователем регионе и резервирования его</li><li>код ФИАС соответствующий названию города</li><li>код ОКАТО соответствующий названию города</li></ul> 

Возможность службы доставки партнера в населенные пункты региона (деревни и села) следует обговорить с сотрудниками интеграции Маркетплейс.

<aside class="notice">Файл .csv с регионами РФ, в которых работает Маркетплейс</aside>

[Скачать](regions.csv)



#Точки самовывоза

Точки самовывоза передаются в виде CSV-таблицы с указанием адреса и режима работы. Необходимо использовать разделитель столбцов "," (запятая).
Если для какого-то регионов не указаны точки самовывоза, покупателю будет предложен вариант доставки курьером.

Для заведения точек самовывоза необходимо обратиться к своему курирующему менеджеру. Все условия описаны в универсальном договоре о сотрудничестве.



##Описание параметров CSV с точками самовывоза
> Пример подготовленного CSV со списком точек самовывоза:

```markdown
Id,TradingPoint,RegionCode,RegionName,Address,workingDays,Saturday,Sunday
"1",737373,1,"Москва","ул. Сладкоежек, 17","09:00-21:00",,
"2",737374,2,"Санкт-Петербург","пр-д Кибернетиков, 64","07:30-15:00","false",
"3",737373,1,"Москва","ул. Трактористов, 11","10:00-20:00","10:00-16:00","false"
"4",737374,2,"Санкт-Петербург","б-р Цоя, 86","10:00-20:00",,
"5",737373,1,"Москва","просп. Мира, 16","09:30-18:15","false","false"
"6",737374,2,"Санкт-Петербург","ул. Малая, 1","09:00-21:00",,"false"
"7",737373,1,"Москва","наб. Левая, 18","11:11-22:22",,
"8",737374,2,"Санкт-Петербург","ул. Живая, 13","10:00-20:00","false",
"9",737373,1,"Москва","ул. Роз, 91","00:00-24:00",,
"10",737374,2,"Санкт-Петербург","ул. 3-х Озер, 12","09:00-21:00","false",
```

| Параметр | Описание |
|-----------------------------|---------------------------------------------------------------------------------------------------------------------------------|
| `Id`<br> string             | Идентификатор точки самовывоза. |
| `TradingPoint`<br> integer  | Код торговой точки, соответствующий данному пункту самовывоза. |
| `RegionCode`<br> integer    | Идентификатор региона. Значение берется из списка регионов, в которых работает маркетплейс. |
| `RegionName`<br> string     | Название региона согласно списку. Значение берется из списка регионов, в которых работает маркетплейс. |
| `Address`<br> string        | Адрес точки самовывоза (произвольное описание). |
| `workingDays`<br> string    | Режим работы в будние дни, формат XX:XX-XX:XX, например 11:00-20:00 |
| `Saturday`<br> string       | Режим работы в субботу, формат XX:XX-XX:XX, например 11:00-20:00. Если поле остается пустым, берется значение из workingDays, если указано false —в субботу пункт не работает. |
| `Sunday`<br>string | Режим работы в воскресенье, формат XX:XX-XX:XX, например 11:00-20:00. Если поле остается пустым, берется значение из Saturday, если указано false - в воскресенье пункт не работает. |

#Аутентификация

```shell
curl -X POST https://example.com/order/check \
  -H 'Content-Type: application/json' \
  -H 'cache-control: no-cache' \
  -H 'X-token: 1q2w3e4r5t6y' \
  -d '{"offersRequest":[
  {
    "offerId":"123",
    "quantity":1,
    "regionId":77,
    "productCode":"0-0-6"
  }
]}'
```

Для обеспечения более высокого уровня защищенности, вы можете сгенерировать токен, который Маркетплейс будет использовать при выполнении запросов по API.

Сгенерированный токен будет передаваться в хэдере **X-token**, как на примере.

<aside class="notice">Для установления шифрованного TLS соединения по протоколу HTTPS в Маркетплейс используется библиотека <a href="https://www.openssl.org">openssl 1.1.1</a>, из-за чего могут возникнуть проблемы при подключении с некоторыми устаревшими и небезопасными алгоритмами, напрмер SHA-1.</aside>

#Процесс работы с заказом
##Обработка заказов c корзиной посредством обмена статусами по API
###Процесс покупки товара с доставкой
В этом сценарии показан процесс обработки заказа с доставкой. Блоки выделенные серым цветом означают вызов метода API. Значения на переходах, написанные латиницей, означают статус, передаваемый в методе.
![](MRKT_FB_Delivery.png)
###Процесс покупки товара с самовывозом
Данный сценарий отличается от предыдущего лишь финальным этапом, в котором партнер доставляет товар на пункт самовывоза.
![](MRKT_FB_Pickup.png)
###Процесс отмены траназкции и заказа со стороны партнера
Этот сценарий описывает полную или частичную отмену заказа с помощью новых методов в партнерском API 2.1.
![](MRKT_FB_Cancel.png)
##Обработка заказов Мультибанка посредством обмена статусами по API
###Покупка товара с доставкой курьером
Данный сценарий предполагает, что Покупатель подписывает договор без участия партнера, после чего инициируется процесс доставки.
![](image_delivery_curier.png)
###Покупка товара с последующим самовывозом
Данный сценарий предполагает, что в точке самовывоза партнера присутствует кредитный специалист, который имеет доступ в систему Банка и полностью сопровождает процесс подписания договора с Покупателем.
![](image_delivery_self.png)



#Версии партнерского API

<aside class="success"><b>Описанные в этом разделе особенности обновлений API соответствуют фазам внедрения на Маркетплейс нового функционала, для работы с которым партнерам необходимо поэтапно внести изменения в партнерское API со своей стороны.</b></aside>

##1.0 - Текущая версия, оформление заказа на кредитный договор
Старый процесс работы, без поддержки передачи нескольких товаров в методах check и reserve. По заказам, со стороны Маркетплейс могут передаваться только статусы SIGNED и CANCELLED.
Описание методов версии 1.0 находится в разделе ["Устаревшие методы API (без корзины)"](#api-3), заключающем документацию, и приводятся исключительно для ознакомления.

##2.0 – Поддержка клиентской корзины в методах API, оформление заказа на кредитный договор
Доступная для подключения на данный момент версия API. Изменения затрагивают методы **POST /order/check** и **POST /order/reserve**. 

[**POST /order/check**](#post-order-check) – визуально метод остается прежним, для партнера необходимо обеспечить корректную обработку нескольких объектов offerId передаваемых в массиве **offersRequest**

[**POST /order/reserve**](#post-order-orderid-reserve) - в этой версии API параметр **productCode** входит в состав объекта offerId передаваемого в массиве **offerIds**. Партнер со своей стороны должен обеспечить обработку постановки в резерв всех передаваемых в запросе товаров, вне зависимости от выбранного клиентом срока рассрочки. Важно понимать, что на этой фазе внерения функционала корзина товаров еще не работает на Маркетплейс, то есть в реальных запросах на резерв будет передаваться только один товар. Возможность заказа покупателем нескольких товаров будет включена только с переходом партнера на версию партнерского API 2.1.

##2.1 – Поддержка клиентского кредитного лимита и полный функционал корзины
Готовящаяся на данный момент к запуску версия API, в которой поддерживается полный функционал корзины, а так же полный набор методов, необходимых для работы с процессом кредитного лимита.
Изменения и новые методы этой версии:

* Новый статус [**PAID**](#post-order-orderid-status) (необходимый для передачи партнеру информации об оплате клиентом заказа).
* Новые статусы [**POST /transaction/cancel**](#post-transaction-cancel) (в эндпоинт Маркетплейса) и [**POST /order/transaction**](#post-order-transaction) (в эндпоинт партнера) для отмены транзакцийсо стороны партнера и оповещения партнера об успешной отмене транзакции.
* Запрос [**GET /order/:orderId**](#get-order-orderid), с помощью которого ранее актуализировался статус заказа у партнера заменен на [**POST /orders**](#post-orders).
* Убран параметр productCode из метода [**POST /order/check**](#post-order-check).

С переходом на эту фазу для партнера будет доступен новый процесс обработки заказов. Подробнее о нововведениях можно посмотреть в [этой презентации](korzina_limit.pdf).
<aside class="warning">На стороне партнера в этой версии должна быть поддержка как нового, так и старого процесса оформления заказа, т.к. по старому процессу будет происходить оплата заказов с офомлением кредитного договора в стороннем банке.

* Старый процесс – подписание клиентом кредитного договора (передается статус подписания договора **SIGNED**). 
* Новый процесс – покупка с использованием кредитного лимита (передается статус оплаты заказа **PAID**).
</aside>


#Методы API (версии 2.1)

##→ POST /order/check
**Проверка наличия товара у партнера.**<br>
Метод **check** означает поступающий партнеру запрос на проверку наличия одного или нескольких товаров в выбранном покупателем регионе и вызывается в двух случаях:

* когда покупатель добавляет товар в корзину (в запросе отправляется один массив с offerId)
* в момент когда покупатель переходит из корзины к оформлению заказа (в запросе отправляются все товары, которые покупатель добавил в корзину, это может быть один или несколько массивов с  разными offerId и productCode)

В ответ на запрос партнер должен уведомить о доступности товара, а также прислать условия доставки и самовывоза. Расчет стоимости и срока доставки заказа (в том числе на пункт выдачи) должен производиться на основе доступных для резерва товаров. (Например, если доступно только 3 из 5 переданных в запросе позиций, стоимость доставки должна быть расчитана только для них).

### Входные параметры
`POST https://example.com/order/check`
> Пример запроса POST /order/check:

```shell
curl -X POST https://example.com/order/check \
  -H 'Content-Type: application/json' \
  -H 'cache-control: no-cache' \
  -d '{"offersRequest":[
  {
    "offerId":"123",
    "quantity":1,
    "regionId":77,
    "productCode":"0-0-6"
  },
  {
    "offerId":"456",
    "quantity":1,
    "regionId":77,
    "productCode":"0-0-12"
  }
]}'
```

| Параметр                                                      | Обязательность | Описание                                                                           |
|---------------------------------------------------------------|----------------|------------------------------------------------------------------------------------|
| `offersRequest`<br>  Array of [{offerRequest}](#offerrequest) | Обязательно    | Массив объектов с запросом на проверку наличия товаров, которые выбрал покупатель. |

**Объект offerRequest**

| Параметр                  | Обязательность | Описание                                                                                                             |
|---------------------------|----------------|----------------------------------------------------------------------------------------------------------------------|
| `offerId` <br> string     | Обязательно    | Идентификатор товара из YML-каталога.                                                                                |
| `quantity`<br>integer     | Обязательно    | Количество единиц товара для бронирования.                                                                           |
| `regionId` <br>integer    | Обязательно    | Идентификатор региона                                                                                                |
| `productCode`<br> string  | Необязательно  | Код кредитного продукта (срок рассрочки).<br> Примеры:<ul><li>0-0-3</li><li>0-0-6</li><li>0-0-10</li><li>0-0-12</li><li>0-0-18</li><li>0-0-24</li><li>0-0-36</li></ul> |

<aside class="warning">
Срок рассрочки является важным параметром только для процесса с кредитным договором и будет удален из запроса в версии API 2.1 (с поддержкой кредитного лимита).
</aside>

###Параметры ответа
`HTTP status code 200 OK — Список товаров с указанием наличия и условий.`
> Пример ответа в JSON:

```json
{
   "offersResponse":[
      {
         "status":"available",
         "offerId":"123",
         "quantity":1,
         "points":[
            "0"
         ]
      },
      {
         "status":"available",
         "offerId":"456",
         "quantity":1,
         "points":[
            "0"
         ]
      }
   ],
   "DeliveryOptions":{
      "delivery":[
         {
            "DeliveryID":1,
            "DeliveryName":"Доставка СДЭК",
            "Cost":1000,
            "Days":"1-2"
         }
      ]
   }
}
```

| Параметр | Обязательность | Описание |
|-------------------------------------------|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| offersResponse Array of [{offerResponse}](#offerresponse)| Обязательно | Массив объектов со статусом резерва по каждому из запрошенных товаров. |
| DeliveryOptions [{DeliveryOption}](#deliveryoption)| Обязательно | Дополнительная информация по параметрам доставки, которую сможет выбрать покупатель. Партнер должен предоставить варианты доставки для всей группы товаров. |

**Объект offerResponse**
<aside class="notice">
В случае наличия самовывоза, необходимо сначала указать deliveryOptions со всеми доступными точками самовывоза, при этом для каждого оффера должно быть указано, в какой точке он конкретно доступен в массиве "points".
</aside>

| Параметр | Обязательность | Описание |
|----------|----------------|-------------------------------------------------------------------------------------------------------------------------------------|
| `offerId`<br>string | Обязательно | Идентификатор товара из YML-каталога. |
| `status`<br>string | Обязательно | Варианты:<ul><li>‘available’ — товар доступен;</li><li>‘unavailable’ — товар недоступен.</li></ul> |
| `quantity`<br>integer | Обязательно | Доступное количество товара. |
| `points`<br> Array of string | Обязательно | Идентификаторы пунктов самовывоза, в которых доступен товар.<br>Также необходимо добавлять в список 0, если доступна доставка курьером. Пустой массив - товар недоступен. |
| `reason`<br>string | Необязательно | Указывается, если товар недоступен (пример: “not in stock”). |


**Объект DeliveryOption**
<aside class="warning">
Обратите внимание, что объект "deliveryOptions"(опции по доставке) должен быть один для всех офферов!
Соответственно, стоимость доставки передается общей суммой за доставку нескольких товаров.
</aside>

| Параметр | Обязательность | Описание  |
|---------------------------------|----------------|---------------------------------------------------------------------------------------------------------------------------------|
| `delivery`<br> Array of Objects | Обязательно, при наличии доставки | Список вариантов доставки с указанием параметров: <ul><li>**deliveryId** (int) — идентификатор службы доставки в системе партнера (будет передано при резервировании заказа);</li> <li>**deliveryName** (string) — название службы доставки (будет отображено Покупателю);</li> <li>**cost** (int) — стоимость доставки (если параметр отсутствует, то стоимость необходимо уточнять у службы доставки);</li><li>**days** (string) — время доставки в днях (возможно указать интервал “5-7”, который интерпретируется как “доставка от 5 до 7 дней”).</li></ul>|
| `pickup`<br> Array of Objects | Обязательно, при наличии самовывоза | Список точек самовывоза доступные для заказа с указанием параметров:<ul><li> **point** (string) — идентификатор точки самовывоза из CSV;</li> <li>**cost** (int) — стоимость за услугу самовывоза, можно указать 0 или не указывать данные параметр если самовывоз бесплатный;</li> <li>**days** (string) — время доставки товара на точку самовывоза, после которой товар можно забрать, 0 - если можно забрать в тот же день (возможно указать интервал “5-7”, который интерпретируется как “доставка на пункт выдачи от 5 до 7 дней”).</li></ul> |

### Обработка ошибок
> Пример ответа в JSON:

```json
{"errorFields":[
    {"price": "price is required"},
    {"offerId": "not found"}]
}
```
| Код HTTP | Описание |
|----------|---------------------------------------------------------------------------------|
| 5xx | Внутренняя ошибка сервера партнера. |
| 422 | Неверный формат запроса (указаны неверные или не указаны обязательные параметры запроса). В теле запроса необходимо передавать поля, которые переданы с ошибкой и указывать в чем она заключается.  Формулировка ошибки может быть произвольной строкой (см. пример). |


##→ POST /order/:orderId/reserve
**Резервирование товара у партнера**<br>
После того, как покупатель выбрал нужные ему товары и способ доставки, при продолжении оформления заказа и переходу к выбору способов оплаты, партнеру приходит запрос на резервирование товара до момента оплаты заказа клиентом.
В заказе может быть любое число товаров, которые будут переданы в массивах запросов, описанных ниже, поэтому для примера используется случай, когда в массиве передано два товара.

### Входные параметры
`POST https://example.com/order/:orderId/reserve`

> Пример запроса POST /order/:orderId/reserve:

```shell
curl -X POST https://example.com/order/18022600000999/reserve \
  -H 'Content-Type: application/json' \
  -H 'cache-control: no-cache' \
  -d '{
  "orderId": "18022600000999", 
  "offerIds": [
    {
      "offerId": "123", 
      "quantity": 2, 
      "price": 19000.0,
      "priceTotal": 20000.0,
      "productCode": "0-0-6"
    },
    {
      "offerId": "456", 
      "quantity": 1, 
      "price": 10500.0,
      "priceTotal": 11000.0,
      "productCode": "0-0-12"
    }
    ], 
  "regionId": 77, 
  "pointId": "0",
  "DeliveryId": 7,
  "client": { "firstName": "Иван", "lastName": "Иванов", "phone": "1244567", "email":"test@test.ru" },
  "address": {"country": "Россия", "region": "Москва", "district": "", "town": "Москва", "locality": "", "street": "Обводного канала", "house": "199", "flat": "", "block": "", "building": "", "zipcode": "190020"}
}'
```

| Параметр | Обязательность | Описание |
|---------------------------------|----------------|--------------------------------------------------------------------------------------|
| `orderId`<br>  string | Обязательно | Идентификатор заказа, сгенерированный на стороне маркетплейса. |
| `offerIds`<br> Array of [{offer}](#offer-3)| Обязательно | Массив объектов с идентификаторами товаров и их количество. |
| `regionId`<br> integer | Обязательно | Идентификатор региона из списка. |
| `pointId`<br> string | Обязательно | Идентификатор точки самовывоза из CSV, 0 - если выбрана доставка курьером. |
| `DeliveryId`<br> integer  | Необязательно | Идентификатор службы доставки в системе партнера. |
| `address`<br> [{address}](#address)| Необязательно | Адрес в формате КЛАДР, указывается, если выбрана доставка курьером. |
| `client`<br> [{clientInfo}](#clientinfoubu)| Обязательно(для метода reserve) | Информация о клиенте. |
                       
**Объект offer**

| Параметр | Обязательность | Описание |
|------------------------|----------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `offerId`<br> string | Обязательно | Идентификатор товара из YML-каталога. |
| `quantity`<br> integer | Обязательно | Количество единиц товара. |
| `price`<br> float | Обязательно | Цена товара с учетом скидки, предоставляемой партнером. Размер скидки зависит от используемого кредитного продукта (срока рассрочки) и согласован с партнером. |
| `priceTotal`<br> float | Обязательно | Цена товара без учета скидки, то есть стоимость товара, которую партнер заявил в своем каталоге. |
| `productCode`<br> string | Необязательно | Код кредитного продукта (срок рассрочки).<br> Примеры:<ul><li>0-0-3</li><li>0-0-6</li><li>0-0-10</li><li>0-0-12</li><li>0-0-18</li><li>0-0-24</li><li>0-0-36</li></ul> |
 
**Объект address**

Столбец "Обязательность" в этой таблице указывает на элементы, которые могут содежаться в массиве адреса. В зависимости от введенного клиентом адреса, распознавание его и заполнение в теги может быть произвольным, просьба советоваться с сотрудниками интеграции при установке каких-либо проверок на обязательность тех или иных полей в этом массиве.

| Параметр | Обязательность | Описание |
|-----------------------|----------------|------------------|
| `country`<br>  string | Обязательно | Код страны по КЛАДР |
| `region`<br> string | Обязательно | Регион |
| `district`<br>string | Необязательно | Район |
| `town`<br>string | Необязательно | Город |
| `locality`<br>string | Необязательно | Населенный пункт |
| `street` <br>string | Обязательно | Улица |
| `house`<br> string | Обязательно | Дом |
| `flat` <br>string | Необязательно | Квартира |
| `block` <br>string | Необязательно | Корпус |
| `building` <br>string | Необязательно | Строение |
| `zipcode` <br>string | Обязательно | Индекс |

**Объект clientInfo**

| Параметр | Обязательность | Описание |
|------------------------|----------------|---------------------------------------------------|
| `firstName`<br>string | Обязательно | Имя клиента |
| `lastName`<br>string | Обязательно | Фамилия клиента |
| `middleName`<br>string | Необязательно | Отчество клиента |
| `email`<br>string | Необязательно | E-mail |
| `phone`<br>string | Обязательно | Номер телефона клиента (должен быть ровно 10 цифр, без кода страны) |

### Параметры ответа
`HTTP status code 200 OK — Оба товара зарезервированы.`

```json
{
   "orderId":"18022600000999",
   "partnerOrderId":"17814",
   "offersResponse":[
      {
         "offerId":"123",
         "status":"reserved"
      },
      {
         "offerId":"456",
         "status":"reserved"
      }
   ]
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|------------------------------------------------------------|
| `orderId` <br>string | Обязательно | Идентификатор заказа, сгенерированный на стороне Маркетплейса |
| `partnerOrderId` <br>string | Обязательно | Идентификатор заказа, сгенерированный на стороне партнера |
| `offerId`<br> string | Обязательно | Идентификатор товара из YML-каталога |
| `status`<br> string | Обязательно | значение: "reserved" |


`HTTP status code 200 OK — Один из товаров недоступен для резервирования.`

```json
{
   "orderId":"18022500002104",
   "partnerOrderId":"17814",
   "offersResponse":[
      {
         "offerId":"123",
         "status":"reserved"
      },
      {
         "offerId":"456",
         "status":"cancelled",
         "reason":"not in stock"
      }
   ]
}

```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|------------------------------------------------------------------------------|
| `orderId` <br>string | Обязательно | Идентификатор заказа, сгенерированный на стороне Маркетплейса |
| `partnerOrderId` <br>string | Обязательно | Идентификатор заказа, сгенерированный на стороне партнера |
| `offerId`<br> string | Обязательно | Идентификатор товара из YML-каталога |
| `status`<br> string | Обязательно | значение: 'cancelled' |
| `reason` <br>string | Обязательно | Причина отказа в резервировании (Пример: 'address is not in delivery area') |

`HTTP status code 200 OK — Оба товара недоступны для резервирования.`

```json
{
   "orderId":"18022500002104",
   "offersResponse":[
      {
         "offerId":"123",
         "status":"cancelled",
         "reason":"not in stock"
      },
      {
         "offerId":"456",
         "status":"cancelled",
         "reason":"not in stock"
      }
   ]
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|------------------------------------------------------------------------------|
| `orderId`<br>string | Обязательно | Идентификатор заказа, сгенерированный на стороне Маркетплейса |
| `offerId`<br> string | Обязательно | Идентификатор товара из YML-каталога |
| `status`<br> string | Обязательно | значение: 'cancelled' |
| `reason`<br>string | Обязательно | Причина отказа в резервировании (Пример: 'address is not in delivery area') |

### Обработка ошибок 
 > Пример ответа в JSON:
 
```json
{
   "errorFields":[
      {
         "clientInfo":{
            "phone":"phone is required"
         }
      }
   ]
}
```

| Параметр | Описание |
|----------|-----------------------------------|
| `5xx` | Внутренняя ошибка сервера партнера. |
| `422` | Неверный формат запроса (указаны неверные или не указаны обязательные параметры запроса).<br> В теле запроса необходимо передавать поля, которые переданы с ошибкой и указывать в чем она заключается. Формулировка ошибки может быть произвольной строкой (см. пример). |
| `404` | Заказ не существует или указан неверный идентификатор. |

Так же, если партнер ответил ошибкой на запрос резерва или прокидывание статуса, Marketpalce будет ретраить эти запросы до получения валидного ответа, либо пока не исчерпает лимит ретраев. Конечными HTTP-статусами являются: 200, 201, 422, 404. Если партнер ответит одним из этих кодов, то выполнение запроса будет считаться успешным и дальше повторяться не будет. Все остальные HTTP-code и невалидные ответы приведут к повторным запросам. Лимит ретраев 10 штук, интервал между повторами не является константой и увеличивается с каждой неудачной попыткой. Данный механизм, в основном, является защитой от потери сообщений по API в случае кратковременной недоступности сервера партнера (например, при получении HTTP-code 500, 503, 504).



##→ POST /order/:orderId/status
**Передача статуса заказа партнеру**

Данным методом Маркетплейс передает партнеру статус заказа в случае его оплаты, подписания кредитной заявки, либо его отмены. Передача статуса оплаты, либо подписания кредитной заявки (после перехода Маркетплейс на процесс использования кредитных лимитов, этот статус нужен для поддержки работы Мультибанка) служит для партнера сигналом для доставки заказа клиенту или на пункт самовывоза.

**Возможные сценарии:**

| Статус | Описание | Действия партнера |
|-------------------------------------|----------------------------------------------------------------------|----------------------------------------------------------------------------------|
| `PAID`<br>Заказ оплачен | Клиент подтвердил оплату заказа, и деньги были переведны на счет партнера. | Партнер может выдать товар на пункте самовывоза, либо начинает процесс доставки. |
| `SIGNED`<br>Кредитный договор подписан<br>(После перехода на процесс с кредитными лимитами, необходим для поддержки работы Мультибанка.) | Покупатель подписал кредитный договор и ожидает получение товара. | Партнер может выдать товар на пункте самовывоза, либо начинает процесс доставки. |
| `CANCELLED`<br>Заказ отменен | Отказ клиента. Также можно интерпретировать как отмена бронирования. | Партнер отменяет заказ. |

<br>
`POST https://example.com/order/:orderId/status со статусом PAID`
> Пример запроса POST /order/:orderId/status:

```shell
curl -X POST \
  https://example.com/order/18022600000999/status \
  -H 'Content-Type: application/json' \
  -H 'cache-control: no-cache' \
  -d '{
    "orderId": "18022600000999",
    "partnerOrderId": "17814",
    "status": "PAID",
    "transactions": [
        {
            "offerId": "123",
            "extTransactionId": "iddqd"
        },
        {
            "offerId": "123",
            "extTransactionId": "idkfa"
        },
        {
            "offerId": "456",
            "extTransactionId": "idbehold+l"
        }
    ]
}'
```

### Входные параметры

| Параметр | Обязательность | Описание |
|----------------------------|----------------|-------------------------------------------------------------------------------------------------------------------------|
| `orderId`<br>string | Обязательно | Идентификатор заказа, сгенерированный на стороне Маркетплейс |
| `partnerOrderId`<br>string | Обязательно | Идентификатор заказа, сгенерированный на стороне партнера |
| `status`<br>string | Обязательно | Статус заказа |
| `transactions`<br>Array of {transactions} | Обязательно, если статус **PAID** | Массив объектов с идентификаторами транзакций и товаров, по которым была транзакция |

**Объект transactions**

| Параметр | Обязательность | Описание |
|----------------------------|----------------|-------------------------------------------------------------------------------------------------------------------------|
| `offerId`<br>string | Обязательно | Идентификатор товара из YML-каталога |
| `extTransactionId`<br>string | Обязательно | Идентификатор транзакции, принадлежащей указанному в массиве offerId |
<br>

`POST https://example.com/order/:orderId/status со статусом SIGNED и CANCELLED`

> Пример запроса POST /order/:orderId/status:

```shell
curl -X POST \
  https://example.com/order/18022600000999/status \
  -H 'Content-Type: application/json' \
  -H 'Content-Type: python-requests/2.22.0' \
  -H 'cache-control: no-cache' \
  -d '{
    "orderId":"18022600000999",
    "partnerOrderId":"777",
    "status":"SIGNED"
  }'
```

| Параметр | Обязательность | Описание |
|----------------------------|----------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `orderId`<br>string | Обязательно | Идентификатор заказа, сгенерированный на стороне Маркетплейс. |
| `partnerOrderId`<br>string | Обязательно | Идентификатор заказа, сгенерированный на стороне партнера. |
| `status`<br>string | Обязательно | Статус заказа (передается в качестве url-параметра).<br> Возможные варианты:<br><ul><li> CANCELLED - Заказ отменен. Отказ клиента.</li> <li>SIGNED - Кредитный договор подписан.</li></ul> |

###Параметры ответа
`HTTP status code 200 OK —  Товар принят в обработку.`

> Примеры ответов в JSON:

```json
{
  "orderId": "18022600000999",
  "partnerOrderId": "12345",
  "status": "reserved"
 
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|-----------------------------------------------------------|
| `orderId`<br> string | Обязательно  | Идентификатор заказа, сгенерированный на стороне маркетплейса |
| `partnerOrderId` <br>string | Необязательно | Идентификатор заказа, сгенерированный на стороне партнера. |
| `status`<br> string | Обязательно | Значение: 'reserved' |


`HTTP status code 200 OK — Товар доставляется.`

```json
{
   "orderId":"18022600000999",
   "partnerOrderId":"12345",
   "status":"delivering"
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|-----------------------------------------------------------|
| `orderId`<br> string      | Обязательно  | Идентификатор заказа, сгенерированный на стороне маркетплейса |
| `partnerOrderId` <br>string | Необязательно | Идентификатор заказа, сгенерированный на стороне партнера. |
| `status`<br> string | Обязательно | Значение: 'delivering'. |


`HTTP status code 200 OK — Товар не будет доставлен(Отмена заказа).`

```json
{
   "orderId":"18022600000999",
   "partnerOrderId":"12345",
   "status":"cancelled",
   "reason":"address is not in delivery area"
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|-----------------------------------------------------------|
| `orderId`<br> string      | Обязательно  | Идентификатор заказа, сгенерированный на стороне маркетплейса |
| `partnerOrderId` <br>string | Необязательно | Идентификатор заказа, сгенерированный на стороне партнера. |
| `status`<br> string | Обязательно | Значение: 'reserved' |
| `reason` <br> string | Обязательно | Причина отказа (Пример: 'address is not in delivery area'). |


###Обработка ошибок 
 > Пример ответа в JSON:
 
```json
{
   "errorFields":[
      {
         "status":"not valid status"
      }
   ]
}
```

| Параметр | Описание |
|----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `5xx` | Внутренняя ошибка сервера партнера. |
| `422` | Неверный формат запроса (указаны неверные или не указаны обязательные параметры запроса).<br> В теле запроса необходимо передавать поля, которые переданы с ошибкой и указывать в чем она заключается. Формулировка ошибки может быть произвольной строкой (см. пример). |
| `404` | Заказ не существует или указан неверный идентификатор. |



##← POST /transactions/cancel
**Отмена транзакции со стороны партнера**

В случае, если со стороны партнера появляется необходимость удалить из заказа(-ов) один или более товаров, например, в случае отказа клиента, или возврата товара, партнер имеет возможность вызвать метод **POST /transactions/cancel** в эндпоинте Маркетплейса. 

URL, для вызова метода: `https://api.market.homecredit.ru/transactions/cancel`

Для обеспечения безопасности, в этом методе передаются не сырые данные, а **hash_hmac** рассчитанные по алгоритму **SHA256** от **str(partner_order_id)+":" +str(transaction_id)** и подписанные ключом юридического лица, который будет выдаваться индивидуально каждому партнеру.

###Методика формирования **hash_hmac**:
Входные данные:

* legal_entity_secret: bytes - ключ юр.лица
* partner_order_id: str - id заказа на стороне партнера (partnerOrderId)
* transaction_id: str - id транзакции (transactionId)

Расчет:

`message: bytes - partner_order_id + ":" + transaction_id`

`hmac: str - hmac.new(key=legal_entity_secret, msg=message, digestmod='SHA256').hexdigest()`

###Возможные сценарии:

* В случае запроса на отмену в течение дня оплаты будет выполнен откат транзакции
* В случае запроса на отмену на следующий день после оплаты и далее будет выполнен возврат денежных средств

###Входные параметры

> Пример запроса POST /transactions/cancel

```shell
curl -X POST \
  https://api.market.homecredit.ru/transactions/cancel \
  -H 'Auth-key: hduw6q3ei1ufqg183et1ydg18v' \
  -d '{
    "transactions": [
        "hash_hmac1",
        "hash_hmac2",
        "hash_hmac3"
    ]
}'

```

<aside class="warning">Наличие выданного партнеру Auth-key в хэдере запроса обязательно!</aside>

| Параметр | Обязательность | Описание |
|-----------------------------------------|-------------|------------------------------------------------------------------------|
| `transactions`<br> Array of {hash_hmac} | Обязательно | Один или несколько хэшей **hash_hmac** переданных в формате **string** |

###Логика ответа
Так как процесс работы с транзакциями происходит на стороне Маркетплейса асихнронно, отмена будет происходить не мгновенно. Возможные варианты ответа на запрос (в скобках указан HTTP status code):

* Принято к отмене (200) – Запрос об отмене транзакций был принят и передан в обработку.
* Неверная сигнатура запроса (422) - Ошибка обработки запроса. Запрос не был принят.
* Доступ запрещен (403) - Токен X-header не валиден, партнер не определен. Запрос не был принят.
* (429) – Превышен лимит обращений от партнера. Лимит составляет 100 запросов в минуту.

###Примеры ответов с описанием параметров

`HTTP status code 200 OK — Запрос был успешно принят и передан в обработку.`

```json
{
    "status": true,
    "data": {
        "message": "Принято к отмене"
    },
    "errors": {}
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|--------------------------------------------------------------|
| `status`<br>enum | Обязательно | Статус отвечаемый на запрос. Может принимать значения true либо false. |
| `data`<br> Object | Обязательно | Объект с данными, содержащий сообщение. |
| `message`<br> string | Обязательно | Текст сообщения. |
| `errors`<br> Object | Обязательно | Объект с данными, содержащий ошибки. |

<br>
`HTTP status code 422 Unprocessable Entity — Неверная сигнатура запроса.`

```json
{
    "status": false,
    "data": {},
    "errors": {
        "non-fields": [],
        "fields": [
            {
                "field": "transactions",
                "detail": "not found",
                "title": "validation error"
            }
        ]
    }
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|-------------------------------------------------------------|
| `status`<br>boolean | Обязательно | Статус отвечаемый на запрос. Может принимать значения true либо false. |
| `data`<br> Object | Обязательно | Объект с данными, содержащий сообщение. |
| `errors`<br> Object | Необязательно | Объект |
| `fields`<br> Array of {detail} | Необязательно | Массив объектов с данными об допущенной ошибке в параметрах запроса. |
| `detail`<br> string | Обязательно | Описание ошибки или null. |
| `title`<br> string | Необязательно | Заголовок ошибки. |
| `field`<br> string | Необязательно | Название параметра, в котором была допущена ошибка. |
| `non-fields`<br> Array of {} | Необязательно | Массив объектов с данными об допущенной ошибке вне параметров запросов. |

<br>
`HTTP status code 403 Forbidden — Доступ запрещен.`

```json
{
    "status": false,
    "data": {},
    "errors": {
        "non-fields": [
            {
                "detail": "Недопустимый запрос",
                "title": "not allowed"
            }
        ],
        "fields": []
    }
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|-------------------------------------------------------------|
| `status`<br>boolean | Обязательно | Статус отвечаемый на запрос. Может принимать значения true либо false. |
| `data`<br> Object | Обязательно | Объект с данными, содержащий сообщение. |
| `errors`<br> Object | Необязательно | Объект |
| `non-fields`<br> Array of {detail} | Необязательно | Массив объектов с данными об допущенной ошибке вне объектов запроса. |
| `detail`<br> string | Обязательно | Описание ошибки или null. |
| `title`<br> string | Необязательно | Заголовок ошибки. |
| `fields`<br> Array of {detail} | Необязательно | Массив объектов с данными об допущенной ошибке в параметрах запроса. |

<br>
`HTTP status code 429 Too Many Requests — Превышен лимит обращений от партнера.`

```json
{
    "status": false,
    "data": {},
    "errors": {}
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|-------------------------------------------------------------|
| `status`<br>boolean | Обязательно | Статус отвечаемый на запрос. Может принимать значения true либо false. |
| `data`<br> Object | Обязательно | Объект с данными, содержащий сообщение. |
| `errors`<br> Object | Необязательно | Объект |

<aside class="warning">
В случае отказа клиента от товара, согласно ст.26 Закона РФ «О защите прав потребителей» необходимо сообщить в службу клиентского сервиса Маркетплейс по адресу электронной почты: MPSupport@homecredit.ru и выполнить отмену транзакции в течение 2 (двух) дней. При возникновении сложностей максимальный срок обработки заказа может составлять 10 (десять) дней.

В случае полной отмены заказа, кроме выполнения запроса на отмену всех траназкций в заказе, на запрос статуса по заказу партнер должен отдавать статус "CANCELLED". Автоматический перевод заказа в статус "CANCELLED" не производится.
</aside>


##→ POST /order/transaction
**Нотификация партнера по статусу обработки запроса на отмену транзакции**

После обработки запроса на отмену транзакции, результат выполнения запроса будет передан партнеру путем вызова данного метода.
Возможные варианты сообщения:

* Транзакция отменена
* Транзакцию невозможно отменить
* Транзакция не найдена

###Входные параметры

`POST https://example.com/order/transaction`

> Пример запроса POST /order/transaction если транзакция найдена

```shell
curl -X POST \
  https://example.com/order/transaction \
  -H 'Content-Type: application/json' \
  -H 'Content-Type: python-requests/2.22.0' \
  -H 'cache-control: no-cache' \
  -d '{
    "data":{
    "transactions": [
        {
            "id": "hash_hmac1",
            "status": "CANCELLED"
        }
    ]
}
}'
```

> Транзакцию невозможно отменить

```json
{
   "data":{
      "transactions":[
         {
            "id":"hash_hmac2",
            "status":"ERROR",
            "detail":"Error"
         }
      ]
   }
}

```

> Транзакция не найдена

```json
{
   "data":{
      "transactions":[
         {
            "id":"hash_hmac3",
            "status":"NOT_FOUND",
            "detail":"Not found"
         }
      ]
   }
}

```

| Параметр | Обязательность | Описание |
|-----------------------------------------|-------------|------------------------------------------------------------------------|
| `data`<br> Object | Обязательно | Объект содержащий transactions |
| `transactions`<br> Array of {hash_hmac} | Обязательно | Массив объектов с хешами транзакций и статусами обработки. |

**Объект transactions**

| Параметр | Обязательность | Описание |
|-----------------------------------------|-------------|------------------------------------------------------------------------|
| `id`<br> string | Обязательно | Один или несколько хэшей **hash_hmac** переданных в формате **string** |
| `status`<br> enum-string | Обязательно | Может принимать одно из трех значений:<ul><li>CANCELLED</li><li>ERROR</li><li>NOT_FOUND</li></ul>  |
| `detail`<br> string | Необязательно | Описание ошибки в случае невозможности отмены транзакции. |

### Параметры ответа

От партнера ожидается ответ с `HTTP status code 200 OK`, и пустым телом. Обработка ошибкок не предусмотрена.



##→ POST /orders
**Запрос статуса одного или нескольких заказов у патнера**

###Входные параметры

`POST https://example.com/orders`

> Пример запроса POST /orders

```shell
curl -X POST \
  https://example.com/orders \
  -H 'Content-Type: application/json' \
  -H 'User-Agent: python-requests/2.22.0' \
  -H 'cache-control: no-cache' \
  -d '{
    "orders": [
        "18022600000995",
        "18022600000996",
        "18022600000997",
        "18022600000998",
        "18022600000999"
    ]
  }'

```

| Параметр | Обязательность | Описание |
|---------------------------------|-------------|------------------------------------------------------------------------------------------------|
| `orders`<br> Array of {orderId} | Обязательно | Идентификаторы заказов, сгенерированные на стороне Маркетплейс переданные в формате **string** |



### Логика ответа

Возможные сценарии:

| Статус | Описания | Действия MarketPlace |
|----------------------------|---------------------------------------------------|---------------------------------------------------------------------------------|
| Товар зарезервирован (reserved) | Партнер подтвердил, что выбранный товар зарезервирован до момента подписания покупателем кредитного договора | Для процесса с кредитным лимитом: MarketPlace переводит покупателя на этап оплаты заказа. Для старого процесса: MarketPlace отправляет договор на подписание (в случае курьерской доставки), либо готовит печатные формы договора (в случае подписания на торговой точке партнера). |
| Товар находится в процессе доставки (delivering) | Партнер сообщает, что товар находится в процессе доставки Покупателю. | MarketPlace обновляет статус в ЛК покупателя и ожидает получение финального статуса. |
| Товар доставлен (delivered) | Партнер сообщает, что товар доставлен/выдан Покупателю. | MarketPlace обновляет статус в ЛК покупателя. |
| Заказ отклонен (cancelled) | Партнер сообщает, что заказ был отклонен на этапе резервирования. Дополнительно указывает причину отказа в поле reason. | - |

###Параметры ответа
`HTTP status code 200 OK - Возвращен статус заказа и дополнительная информация.`

> Пример ответа в JSON:

```json
{
   "orders":[
      {
         "orderId":"18022600000995",
         "status":"reserved",
         "result":"ok",
         "partnerOrderId":"12341"
      },
      {
         "orderId":"18022600000996",
         "status":"delivering",
         "result":"ok",
         "partnerOrderId":"12343",
         "trackId":"TK456789"
      },
      {
         "orderId":"18022600000997",
         "status":"delivered",
         "result":"ok",
         "partnerOrderId":"12342"
      },
      {
         "orderId":"18022600000998",
         "status":"cancelled",
         "result":"ok",
         "reason":"not in stock",
         "partnerOrderId":"12344"
      },
      {
         "orderId":"18022600000999",
         "result":"not found"
      }
   ]
}
```

| Параметр | Обязательность | Описание |
|---------------------------------|-------------|------------------------------------------------------------------------------------------------|
| `orders`<br> Array of {orderId} | Обязательно | Идентификаторы заказов, сгенерированный на стороне Маркетплейс переданные в формате **string** |

**Объект orderId**

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `orderId`<br> string | Обязательно  | Идентификатор заказа, сгенерированный на стороне Маркетплейс.| 
| `status`<br> string | Обязательно | Значения описаны в сценариях выше. |
| `result`<br> string | Обязательно  | Результат поиска номера заказа на стороне партнера. Может принимать значения **"ok"**, или **"not found"**. НЕ ОКОНЧАТЕЛЬНЫЙ ВАРИАНТ, ЗНАЧЕНИЯ МОГУТ БЫТЬ ИЗМЕНЕНЫ. |
| `partnerOrderId`<br> string | Необязательно | Идентификатор заказа, сгенерированный на стороне партнера. Обязательный параметр, если партнер присвоил свой номер заказа на этапе резервирования. |
| `trackId`<br> string | Необязательно | ID для трэкинга заказа, доставляемого транспортной компанией. Обязателен для заказов с доставкой. |
| `reason` <br> string | Необязательно | Причина отказа (Пример: 'not in stock'). Обязателен, если заказ был отменен при резервирвовании. |

### Обработка ошибок 
> Пример ответа в JSON:
 
```json
{
   "errorFields":[
      {
         "status":"not valid Id"
      }
   ]
}
```

| Код HTTP | Описание |
|----------|--------------------------------------------------------|
| 5xx | Внутренняя ошибка сервера партнера. |

<aside class="warning">
В случае возникновения ошибки 5хх произойдет повторный запрос через 60 секунд, если ошибка повторится, партнеру перестанут поступать новые заказы. После пяти попыток с интервалом в минуту партнеру будет направлено email-уведомление о неполадках на его стороне, после чего партнер будет отключен от системы до тех пор, пока не сообщит о том, что работоспособность восстановлена.
</aside>



#Методы API (версии 2.0 с поддержкой корзины товаров)

##→ POST /order/check
**Проверка наличия товара у партнера.**<br>
Метод **check** означает поступающий партнеру запрос на проверку наличия одного или нескольких товаров в выбранном покупателем регионе и вызывается в двух случаях:

* когда покупатель добавляет товар в корзину (в запросе отправляется один массив с offerId)
* в момент когда покупатель переходит из корзины к оформлению заказа (в запросе отправляются все товары, которые покупатель добавил в корзину, это может быть один или несколько массивов с  разными offerId и productCode)

В ответ на запрос партнер должен уведомить о доступности товара, а также прислать условия доставки и самовывоза. Расчет стоимости и срока доставки заказа (в том числе на пункт выдачи) должен производиться на основе доступных для резерва товаров. (Например, если доступно только 3 из 5 переданных в запросе позиций, стоимость доставки должна быть расчитана только для них).

### Входные параметры
`POST https://example.com/order/check`
> Пример запроса POST /order/check:

```shell
curl -X POST https://example.com/order/check \
  -H 'Content-Type: application/json' \
  -H 'cache-control: no-cache' \
  -d '{"offersRequest":[
  {
    "offerId":"123",
    "quantity":1,
    "regionId":77,
    "productCode":"0-0-6"
  },
  {
    "offerId":"456",
    "quantity":1,
    "regionId":77,
    "productCode":"0-0-12"
  }
]}'
```

| Параметр                                                      | Обязательность | Описание                                                                           |
|---------------------------------------------------------------|----------------|------------------------------------------------------------------------------------|
| `offersRequest`<br>  Array of [{offerRequest}](#offerrequest) | Обязательно    | Массив объектов с запросом на проверку наличия товаров, которые выбрал покупатель. |

**Объект offerRequest**

| Параметр                  | Обязательность | Описание                                                                                                             |
|---------------------------|----------------|----------------------------------------------------------------------------------------------------------------------|
| `offerId` <br> string     | Обязательно    | Идентификатор товара из YML-каталога.                                                                                |
| `quantity`<br>integer     | Обязательно    | Количество единиц товара для бронирования.                                                                           |
| `regionId` <br>integer    | Обязательно    | Идентификатор региона                                                                                                |
| `productCode`<br> string  | Необязательно  | Код кредитного продукта (срок рассрочки).<br> Примеры:<ul><li>0-0-3</li><li>0-0-6</li><li>0-0-10</li><li>0-0-12</li><li>0-0-18</li><li>0-0-24</li><li>0-0-36</li></ul> |

<aside class="warning">
Срок рассрочки является важным параметром только для процесса с кредитным договором и будет удален из запроса в версии API 2.1 (с поддержкой кредитного лимита).
</aside>

###Параметры ответа
`HTTP status code 200 OK — Список товаров с указанием наличия и условий.`
> Пример ответа в JSON:

```json
{
   "offersResponse":[
      {
         "status":"available",
         "offerId":"123",
         "quantity":1,
         "points":[
            "0"
         ]
      },
      {
         "status":"available",
         "offerId":"456",
         "quantity":1,
         "points":[
            "0"
         ]
      }
   ],
   "DeliveryOptions":{
      "delivery":[
         {
            "DeliveryID":1,
            "DeliveryName":"Доставка СДЭК",
            "Cost":1000,
            "Days":"1-2"
         }
      ]
   }
}
```

| Параметр | Обязательность | Описание |
|-------------------------------------------|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| offersResponse Array of [{offerResponse}](#offerresponse)| Обязательно | Массив объектов со статусом резерва по каждому из запрошенных товаров. |
| DeliveryOptions [{DeliveryOption}](#deliveryoption)| Обязательно | Дополнительная информация по параметрам доставки, которую сможет выбрать покупатель. Партнер должен предоставить варианты доставки для всей группы товаров. |

**Объект offerResponse**
<aside class="notice">
В случае наличия самовывоза, необходимо сначала указать deliveryOptions со всеми доступными точками самовывоза, при этом для каждого оффера должно быть указано, в какой точке он конкретно доступен в массиве "points".
</aside>

| Параметр | Обязательность | Описание |
|----------|----------------|-------------------------------------------------------------------------------------------------------------------------------------|
| `offerId`<br>string | Обязательно | Идентификатор товара из YML-каталога. |
| `status`<br>string | Обязательно | Варианты:<ul><li>‘available’ — товар доступен;</li><li>‘unavailable’ — товар недоступен.</li></ul> |
| `quantity`<br>integer | Обязательно | Доступное количество товара. |
| `points`<br> Array of string | Обязательно | Идентификаторы пунктов самовывоза, в которых доступен товар.<br>Также необходимо добавлять в список 0, если доступна доставка курьером. Пустой массив - товар недоступен. |
| `reason`<br>string | Необязательно | Указывается, если товар недоступен (пример: “not in stock”). |


**Объект DeliveryOption**
<aside class="warning">
Обратите внимание, что объект "deliveryOptions"(опции по доставке) должен быть один для всех офферов!
Соответственно, стоимость доставки передается общей суммой за доставку нескольких товаров.
</aside>

| Параметр | Обязательность | Описание  |
|---------------------------------|----------------|---------------------------------------------------------------------------------------------------------------------------------|
| `delivery`<br> Array of Objects | Обязательно, при наличии доставки | Список вариантов доставки с указанием параметров: <ul><li>**deliveryId** (int) — идентификатор службы доставки в системе партнера (будет передано при резервировании заказа);</li> <li>**deliveryName** (string) — название службы доставки (будет отображено Покупателю);</li> <li>**cost** (int) — стоимость доставки (если параметр отсутствует, то стоимость необходимо уточнять у службы доставки);</li><li>**days** (string) — время доставки в днях (возможно указать интервал “5-7”, который интерпретируется как “доставка от 5 до 7 дней”).</li></ul>|
| `pickup`<br> Array of Objects | Обязательно, при наличии самовывоза | Список точек самовывоза доступные для заказа с указанием параметров:<ul><li> **point** (string) — идентификатор точки самовывоза из CSV;</li> <li>**cost** (int) — стоимость за услугу самовывоза, можно указать 0 или не указывать данные параметр если самовывоз бесплатный;</li> <li>**days** (string) — время доставки товара на точку самовывоза, после которой товар можно забрать, 0 - если можно забрать в тот же день (возможно указать интервал “5-7”, который интерпретируется как “доставка на пункт выдачи от 5 до 7 дней”).</li></ul> |

### Обработка ошибок
> Пример ответа в JSON:

```json
{"errorFields":[
    {"price": "price is required"},
    {"offerId": "not found"}]
}
```
| Код HTTP | Описание |
|----------|---------------------------------------------------------------------------------|
| 5xx | Внутренняя ошибка сервера партнера. |
| 422 | Неверный формат запроса (указаны неверные или не указаны обязательные параметры запроса). В теле запроса необходимо передавать поля, которые переданы с ошибкой и указывать в чем она заключается.  Формулировка ошибки может быть произвольной строкой (см. пример). |


##→ POST /order/:orderId/reserve
**Резервирование товара у партнера**<br>
После того, как покупатель заполнил заявку, выбрал способ доставки и его заявка была одобрена системой скоринга банка, партнеру приходит запрос на резервирование товара до момента подписания кредитного договора клиентом.
В заказе может быть любое число товаров, которые будут переданы в массивах запросов, описанных ниже, поэтому для примера используется случай, когда в массиве передано два товара.

### Входные параметры
`POST https://example.com/order/:orderId/reserve`

> Пример запроса POST /order/:orderId/reserve:

```shell
curl -X POST https://example.com/order/18022600000999/reserve \
  -H 'Content-Type: application/json' \
  -H 'cache-control: no-cache' \
  -d '{
  "orderId": "18022600000999", 
  "offerIds": [
    {
      "offerId": "123", 
      "quantity": 2, 
      "price": 19000.0,
      "priceTotal": 20000.0,
      "productCode": "0-0-6"
    },
    {
      "offerId": "456", 
      "quantity": 1, 
      "price": 10500.0,
      "priceTotal": 11000.0,
      "productCode": "0-0-12"
    }
    ], 
  "regionId": 77, 
  "pointId": "0",
  "DeliveryId": 7,
  "client": { "firstName": "Иван", "lastName": "Иванов", "phone": "1244567", "email":"test@test.ru" },
  "address": {"country": "Россия", "region": "Москва", "district": "", "town": "Москва", "locality": "", "street": "Обводного канала", "house": "199", "flat": "", "block": "", "building": "", "zipcode": "190020"}
}'
```

| Параметр | Обязательность | Описание |
|---------------------------------|----------------|--------------------------------------------------------------------------------------|
| `orderId`<br>  string | Обязательно | Идентификатор заказа, сгенерированный на стороне маркетплейса. |
| `offerIds`<br> Array of [{offer}](#offer-3)| Обязательно | Массив объектов с идентификаторами товаров и их количество. |
| `regionId`<br> integer | Обязательно | Идентификатор региона из списка. |
| `pointId`<br> string | Обязательно | Идентификатор точки самовывоза из CSV, 0 - если выбрана доставка курьером. |
| `DeliveryId`<br> integer  | Необязательно | Идентификатор службы доставки в системе партнера. |
| `address`<br> [{address}](#address)| Необязательно | Адрес в формате КЛАДР, указывается, если выбрана доставка курьером. |
| `client`<br> [{clientInfo}](#clientinfoubu)| Обязательно(для метода reserve) | Информация о клиенте. |
                       
**Объект offer**

| Параметр | Обязательность | Описание |
|------------------------|----------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `offerId`<br> string | Обязательно | Идентификатор товара из YML-каталога. |
| `quantity`<br> integer | Обязательно | Количество единиц товара. |
| `price`<br> float | Обязательно | Цена товара с учетом скидки, предоставляемой партнером. Размер скидки зависит от используемого кредитного продукта (срока рассрочки) и согласован с партнером. |
| `priceTotal`<br> float | Обязательно | Цена товара без учета скидки, то есть стоимость товара, которую партнер заявил в своем каталоге. |
| `productCode`<br> string | Необязательно | Код кредитного продукта (срок рассрочки).<br> Примеры:<ul><li>0-0-3</li><li>0-0-6</li><li>0-0-10</li><li>0-0-12</li><li>0-0-18</li><li>0-0-24</li><li>0-0-36</li></ul> |
 
**Объект address**

Столбец "Обязательность" в этой таблице указывает на элементы, которые могут содежаться в массиве адреса. В зависимости от введенного клиентом адреса, распознавание его и заполнение в теги может быть произвольным, просьба советоваться с сотрудниками интеграции при установке каких-либо проверок на обязательность тех или иных полей в этом массиве.

| Параметр | Обязательность | Описание |
|-----------------------|----------------|------------------|
| `country`<br>  string | Обязательно | Код страны по КЛАДР |
| `region`<br> string | Обязательно | Регион |
| `district`<br>string | Необязательно | Район |
| `town`<br>string | Необязательно | Город |
| `locality`<br>string | Необязательно | Населенный пункт |
| `street` <br>string | Обязательно | Улица |
| `house`<br> string | Обязательно | Дом |
| `flat` <br>string | Необязательно | Квартира |
| `block` <br>string | Необязательно | Корпус |
| `building` <br>string | Необязательно | Строение |
| `zipcode` <br>string | Обязательно | Индекс |

**Объект clientInfo**

| Параметр | Обязательность | Описание |
|------------------------|----------------|---------------------------------------------------|
| `firstName`<br>string | Обязательно | Имя клиента |
| `lastName`<br>string | Обязательно | Фамилия клиента |
| `middleName`<br>string | Необязательно | Отчество клиента |
| `email`<br>string | Необязательно | E-mail |
| `phone`<br>string | Обязательно | Номер телефона клиента (должен быть ровно 10 цифр, без кода страны) |

### Параметры ответа
`HTTP status code 200 OK — Оба товара зарезервированы.`

```json
{
   "orderId":"18022600000999",
   "PartnerOrderId":"17814",
   "offersResponse":[
      {
         "offerId":"123",
         "status":"reserved"
      },
      {
         "offerId":"456",
         "status":"reserved"
      }
   ]
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|------------------------------------------------------------|
| `orderId` <br>string | Обязательно | Идентификатор заказа, сгенерированный на стороне Маркетплейса |
| `PartnerOrderId` <br>string | Обязательно | Идентификатор заказа, сгенерированный на стороне партнера |
| `offerId`<br> string | Обязательно | Идентификатор товара из YML-каталога |
| `status`<br> string | Обязательно | значение: "reserved" |


`HTTP status code 200 OK — Один из товаров недоступен для резервирования.`

```json
{
   "orderId":"18022500002104",
   "PartnerOrderId":"17814",
   "offersResponse":[
      {
         "offerId":"123",
         "status":"reserved"
      },
      {
         "offerId":"456",
         "status":"cancelled",
         "reason":"not in stock"
      }
   ]
}

```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|------------------------------------------------------------------------------|
| `orderId` <br>string | Обязательно | Идентификатор заказа, сгенерированный на стороне Маркетплейса |
| `PartnerOrderId` <br>string | Обязательно | Идентификатор заказа, сгенерированный на стороне партнера |
| `offerId`<br> string | Обязательно | Идентификатор товара из YML-каталога |
| `status`<br> string | Обязательно | значение: 'cancelled' |
| `reason` <br>string | Обязательно | Причина отказа в резервировании (Пример: 'address is not in delivery area') |

`HTTP status code 200 OK — Оба товара недоступны для резервирования.`

```json
{
   "orderId":"18022500002104",
   "offersResponse":[
      {
         "offerId":"123",
         "status":"cancelled",
         "reason":"not in stock"
      },
      {
         "offerId":"456",
         "status":"cancelled",
         "reason":"not in stock"
      }
   ]
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|------------------------------------------------------------------------------|
| `orderId`<br>string | Обязательно | Идентификатор заказа, сгенерированный на стороне Маркетплейса |
| `offerId`<br> string | Обязательно | Идентификатор товара из YML-каталога |
| `status`<br> string | Обязательно | значение: 'cancelled' |
| `reason`<br>string | Обязательно | Причина отказа в резервировании (Пример: 'address is not in delivery area') |

### Обработка ошибок 
 > Пример ответа в JSON:
 
```json
{
   "errorFields":[
      {
         "clientInfo":{
            "phone":"phone is required"
         }
      }
   ]
}
```

| Параметр | Описание |
|----------|-----------------------------------|
| `5xx` | Внутренняя ошибка сервера партнера. |
| `422` | Неверный формат запроса (указаны неверные или не указаны обязательные параметры запроса).<br> В теле запроса необходимо передавать поля, которые переданы с ошибкой и указывать в чем она заключается. Формулировка ошибки может быть произвольной строкой (см. пример). |
| `404` | Заказ не существует или указан неверный идентификатор. |



##→ POST /order/:orderId/status
**Передача статуса кредитной заявки партнера**

Данным методом Маркетплейс передает партнеру статус заявки в случае подписания(signed), что для партнера служит сигналом для доставки заказа клиенту или на пункт самовывоза. Либо отменяет заказ.

<aside class="notice">
Возможные сценарии:
</aside>

| Статус | Описание | Действия партнера |
|-------------------------------|----------------------------------------------------------------------|----------------------------------------------------------------------------------|
| Кредит отменен<br>(CANCELLED) | Отказ клиента. Также можно интерпретировать как отмена бронирования. | Партнер отменяет заказ. |
| Кредит подписан<br>(SIGNED) | Покупатель подписал кредитный договор и ожидает получение товара. | Партнер может выдать товар на пункте самовывоза, либо начинает процесс доставки. |


### Входные параметры
`POST https://example.com/order/:orderId/status`

> Пример запроса POST /order/:orderId/status:

```shell
curl -X POST \
  https://example.com/order/1234567890/status/ \
  -H 'Content-Type: application/json' \
  -H 'cache-control: no-cache' \
  -d '{
    "orderId":"1234567890",
    "PartnerOrderId":"777",
    "status":"SIGNED"
  }'
```
| Параметр | Обязательность | Описание |
|----------------------------|----------------|------------------------------------------------------------------------------------------------------------|
| `orderId`<br>string | Обязательно | Идентификатор заказа, сгенерированный на стороне Маркетплейс. |
| `PartnerOrderId`<br>string | Необязательно | Идентификатор заказа, сгенерированный на стороне партнера. Обязательный параметр, если партнер вернул этот параметр (номера заказа) на этапе резервирования. |
| `status`<br>string | Обязательно | Статус кредитной заявки (передается в качестве url-параметра).<br> Возможные варианты:<br><ul><li> CANCELLED - Кредит отменен.Отказ клиента.</li> <li>SIGNED - Кредит подписан.</li></ul> |

### Параметры ответа
`HTTP status code 200 OK —  Товар принят в обработку.`

> Примеры ответов в JSON:

```json
{
  "orderId": "18022600000999",
  "PartnerOrderId": "12345",
  "status": "reserved"
 
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|------------------------------------------------------------|
| `orderId`<br> string | Обязательно | Идентификатор заказа, сгенерированный на стороне маркетплейса |
| `PartnerOrderId` <br>string | Необязательно | Идентификатор заказа, сгенерированный на стороне партнера. |
| `status`<br> string | Обязательно | Значение: 'reserved' |





`HTTP status code 200 OK — Товар доставляется.`

```json
{
  "orderId": "18022600000999",
  "PartnerOrderId": "12345",
  "status": "delivering"
  
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|------------------------------------------------------------|
| `orderId`<br> string      | Обязательно  | Идентификатор заказа, сгенерированный на стороне маркетплейса |
| `PartnerOrderId` <br>string | Необязательно | Идентификатор заказа, сгенерированный на стороне партнера. |
| `status`<br> string | Обязательно | Значение: 'delivering'. |




`HTTP status code 200 OK — Товар не будет доставлен(Отмена заказа).`

```json
{
  "orderId": "18022600000999",
  "PartnerOrderId": "12345",
  "status": "cancelled",
  "reason": "address is not in delivery area"
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|-------------------------------------------------------------|
| `orderId`<br> string      | Обязательно  | Идентификатор заказа, сгенерированный на стороне маркетплейса |
| `PartnerOrderId` <br>string | Необязательно | Идентификатор заказа, сгенерированный на стороне партнера. |
| `status`<br> string | Обязательно | Значение: 'reserved' |
| `reason` <br> string | Обязательно | Причина отказа (Пример: 'address is not in delivery area'). |


### Обработка ошибок 
 > Пример ответа в JSON:
 
```json
{"errorFields":[
    {
      "status": "not valid status"
    } 
  ]
}
```

| Параметр | Описание |
|----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `5xx`  | Внутренняя ошибка сервера партнера. |
| `422` | Неверный формат запроса (указаны неверные или не указаны обязательные параметры запроса).<br> В теле запроса необходимо передавать поля, которые переданы с ошибкой и указывать в чем она заключается. Формулировка ошибки может быть произвольной строкой (см. пример). |
| `404` | Заказ не существует или указан неверный идентификатор. |



##→ GET /order/:orderId
> Пример запроса GET /order/:orderId:

```shell
curl -X GET \
  https://example.com/order/1234567890 \
  -H 'cache-control: no-cache' \

```

`GET https://example.com/order/:orderId`

### Логика ответа

Возможные сценарии:

| Статус | Описания | Действия MarketPlace |
|----------------------------|---------------------------------------------------|---------------------------------------------------------------------------------|
| Товар зарезервирован (reserved) | Партнер подтвердил, что выбранный товар зарезервирован до момента подписания Покупателем Кредитного договора | MarketPlace отправляет договор на подписание (в случае курьерской доставки), либо готовит печатные формы договора (в случае подписания на торговой точке партнера). |
| Товар находится в процессе доставки (delivering) | Партнер сообщает, что товар находится в процессе доставки Покупателю. | MarketPlace ожидает получение финального статуса. |
| Товар доставлен (delivered) | Партнер сообщает, что товар доставлен/выдан Покупателю. | MarketPlace начинает процедуру взаиморасчета с партнером. |
| Заказ отклонен (cancelled) | Партнер сообщает, что заказ отклонен. Дополнительно указывает причину отказа в поле reason. | MarketPlace отклоняет заказ внутри своей базы данных, информирует Покупателя об отмене. |

<aside class="warning">
После того как партнеру пришел статус SIGNED, отменить заказ в автоматическом режиме невозможно, т.к. у клиента уже на руках подписанный кредитный договор, который необходимо аннулировать через клиентскую поддержку Marketplace.<br>
Для этого необходимо:
<ul><li>Обратиться в поддержку Marketplace по почте <a href="mailto:mpsupport@homecredit.ru">mpsupport@homecredit.ru</a>, указав в письме номер кредитного договора (можно узнать в партнерском ЛК), и причину аннулирования договора</li><li>Отправлять корректный ответ на метод GET /order/:orderId: с "status": "cancelled" и указанием причины в поле "reason"</li></ul>
</aside>

###Параметры ответа
`HTTP status code 200 OK — Товар зарезервирован.`
 
```json
{
    "orderId": "18022600000999",
    "status": "reserved",
    "PartnerOrderId": "12345"
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `orderId`<br> string | Обязательно  | Идентификатор заказа, сгенерированный на стороне Маркетплейс.| 
| `status`<br> string | Обязательно | Значение: 'reserved' |
| `PartnerOrderId`<br> string | Необязательно  | Идентификатор заказа, сгенерированный на стороне партнера. Обязательный параметр, если партнер вернул этот параметр (номера заказа) на этапе резервирования |

`HTTP status code 200 OK — Товар доставляется.`
 
```json
{
    "orderId": "18022600000999",
    "status": "delivering",
    "PartnerOrderId": "12345",
    "trackId": "TK456789"
}
```
| Параметр | Обязательность | Описание |
|-----------------------------|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `orderId`<br> string | Обязательно  | Идентификатор заказа, сгенерированный на стороне Маркетплейс.| 
| `status`<br> string | Обязательно | Значение: 'delivering' |
| `PartnerOrderId`<br> string | Необязательно  | Идентификатор заказа, сгенерированный на стороне партнера. Обязательный параметр, если партнер вернул этот параметр (номера заказа) на этапе резервирования |
| `trackId`<br> string | Необязательно | Id для трэкинга заказа, доставляемого транспортной компанией |

`HTTP status code 200 OK — Заказ доставлен.`
 
```json
{
    "orderId": "18022600000999",
    "status": "delivered",
    "PartnerOrderId": "12345"
}
```
| Параметр | Обязательность | Описание |
|-----------------------------|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `orderId`<br> string | Обязательно  | Идентификатор заказа, сгенерированный на стороне Маркетплейс.| 
| `status`<br> string | Обязательно | Значение: 'delivered' |
| `PartnerOrderId`<br> string | Необязательно  | Идентификатор заказа, сгенерированный на стороне партнера. Обязательный параметр, если партнер вернул этот параметр (номера заказа) на этапе резервирования |

`HTTP status code 200 OK — Заказ отклонен.`

```json
{
    "orderId": "18022600000999",
    "status": "cancelled",
    "reason": "not in stock",
    "PartnerOrderId": "12345"
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `orderId`<br> string | Обязательно  | Идентификатор заказа, сгенерированный на стороне Маркетплейс.| 
| `status`<br> string | Обязательно | Значение: 'cancelled' |
| `PartnerOrderId`<br> string | Необязательно  | Идентификатор заказа, сгенерированный на стороне партнера. Обязательный параметр, если партнер вернул этот параметр (номера заказа) на этапе резервирования |
| `reason` <br> string | Обязательно | причина отказа (Пример: 'not in stock') |

### Обработка ошибок 
 > Пример ответа в JSON:
 
```json
{"errorFields":[
    {
      "status": "not valid Id"
    } 
  ]
}
```

| Код HTTP | Описание |
|----------|--------------------------------------------------------|
| 5xx | Внутренняя ошибка сервера партнера. |
| 404 | Заказ не существует или указан неверный идентификатор. |



#Устаревшие методы API (без корзины)

<aside class="warning">
Описание этих методов приводится ТОЛЬКО ДЛЯ ОЗНАКОМЛЕНИЯ. Текущая реализация все еще поддерживает их, но вскоре будет отключена. Настоятельно рекомендуется использование методов версий 2.0 и выше.
</aside>


##POST /order/check/
**Проверка наличия товара у партнера.**<br>
В момент когда Покупатель выбрал предложение, партнеру поступает запрос на проверку наличия данного товара в регионе. В ответ партнер должен уведомить о возможности зарезервировать товар, а также прислать условия доставки и самовывоза. Расчет параметров получения товара клиентом должен производиться на основе доступных товаров. (Например, если доступно только 3 из 5 переданных в запросе товаров, стоимость доставки должна быть только для этих трех товаров).

### Входные параметры
`POST https://example.com/order/check/`
> Пример запроса POST /order/check/:

```shell
curl -X POST https://example.com/order/check/ \
  -H 'Content-Type: application/json' \
  -H 'cache-control: no-cache' \
  -d '{"offersRequest":[
{"offerId":"123",
"quantity":1,
"regionId":77,
"productCode":"0-0-6"}
]}'
```

| Параметр                                     | Обязательность | Описание                                                                           |
|----------------------------------------------|----------------|------------------------------------------------------------------------------------|
| `offersRequest`<br>  Array of [{offerRequest}](#offerrequest) | Обязательно    | Массив объектов с запросами на проверку наличия товаров, которые выбрал Покупатель. |

**Объект offerRequest**

| Параметр                 | Обязательность | Описание                                                                                                           |
|--------------------------|----------------|--------------------------------------------------------------------------------------------------------------------|
| `offerId` <br> string    | Обязательно    | Идентификатор товара из YML-каталога |
| `quantity`<br>integer    | Обязательно    | Количество единиц товара для бронирования |
| `regionId` <br>integer   | Обязательно    | Идентификатор региона |
| `productCode`<br> string | Обязательно    | Код кредитного продукта.<br> Примеры:<ul><li>0-0-3</li><li>0-0-6</li><li>0-0-10</li><li>0-0-12</li><li>0-0-18</li><li>0-0-24</li><li>0-0-36</li></ul> |


### Параметры ответа
`HTTP status code 200 OK — Список товаров с указанием наличия и условий.`
> Пример ответа в JSON:

```json
{
    "offersResponse": [
        {
            "status": "available",
            "offerId": "123",
            "quantity": 1,
            "points": [
                "0"
            ]
        }
    ],
    "DeliveryOptions": {
        "delivery": [
            {
                "DeliveryID": 1,
                "DeliveryName": "Доставка СДЭК(склад-склад)",
                "Cost": 1000,
                "Days": "1-2"
            }
        ]
    }
}
```

| Параметр | Обязательность | Описание |
|-------------------------------------------|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| offersResponse Array of [{offerResponse}](#offerresponse)| Обязательно | Массив объектов со статусом резерва по каждому из запрошенных товаров. |
| DeliveryOptions [{DeliveryOption}](#deliveryoption)| Обязательно | Дополнительная информация по параметрам доставки, которую сможет выбирать Покупатель. Партнер должен представить варианты доставки для всей группы товаров. |

**Объект offerResponse**

| Параметр | Обязательность | Описание |
|------------------------------|----------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `offerId`<br>integer | Обязательно | Идентификатор товара из YML-каталога. |
| `status`<br>string | Обязательно | Варианты:<ul><li>‘available’ — товар доступен;</li><li>‘unavailable’ — товар недоступен.</li></ul> |
| `quantity`<br>integer | Обязательно | Доступное количество товара. |
| `points`<br> Array of string | Обязательно | Идентификаторы пунктов самовывоза, в которых доступен товар.<br>Также необходимо добавлять в список 0, если доступна доставка курьером. Пустой массив - товар недоступен. |
| `reason`<br>string | Необязательно | Указывается, если товар недоступен (пример: “not in stock”). |

**Объект DeliveryOption**

| Параметр | Обязательность | Описание  |
|---------------------------------|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `delivery`<br> Array of Objects | Необязательно | Список вариантов доставки с указанием параметров: <ul><li>deliveryId—идентификатор службы доставки в системе партнера (будет передано при резервировании заказа);</li> <li>deliveryName— название службы доставки (будет отображено Покупателю);</li> <li>cost— стоимость доставки (если параметр отсутствует, то стоимость необходимо уточнять у службы доставки);</li><li> days— время доставки в днях (возможно указать интервал, например “5-7” интерпретируется как “доставка от 5 до 7 дней”).</li></ul>|
| `pickup`<br> Array of Objects | Необязательно | Список точек самовывоза доступные для заказа с указанием параметров:<ul><li> point — идентификатор точки самовывоза из CSV;</li> <li>cost— стоимость за услугу самовывоза, можно указать 0 или не указывать данные параметр если самовывоз бесплатный;</li> <li>days — время доставки товара на точку самовывоза, после которой товар можно забрать, 0 - если можно забрать в тот же день (возможно указать интервал, например “5-7” интерпретируется как “доставка от 5 до 7 дней”).</li></ul> |

### Обработка ошибок
> Пример ответа в JSON:

```json
{"errorFields":[
    {"price": "price is required"},
    {"offerId": "not found"}]
}
```
| Код HTTP | Описание |
|----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 5xx | Внутренняя ошибка сервера партнера. |
| 422 | Неверный формат запроса (указаны неверные или не указаны обязательные параметры запроса). В теле запроса необходимо передавать поля, которые переданы с ошибкой и указывать в чем она заключается.  Формулировка ошибки может быть произвольной строкой (см. пример). |




##POST /order/:orderId/reserve
**Резервирование товара у партнера**<br>
После того, как Покупатель заполнил заявку, выбрал способ доставки и его заявка была одобрена системой скоринга банка, партнеру приходит запрос на резервирование товара до момента подписания кредитного договора клиентом.

###Входные параметры
`POST https://example.com/order/:orderId/reserve`

> Пример запроса POST /order/:orderId/reserve:

```shell
curl -X POST https://example.com/order/18022500002104/reserve \
  -H 'Content-Type: application/json' \
  -H 'cache-control: no-cache' \
  -d '{
  "orderId": "18022500002104", 
  "offerIds": [
    {
      "offerId": 777, 
      "quantity": 1, 
      "price": 4000.0,
      "priceTotal": 5000.0
    }
    ], 
  "regionId": 77, 
  "pointId": "0",
  "DeliveryId": 7,
  "productCode": "0-0-3",
  "client": { "firstName": "Иван", "lastName": "Иванов", "phone": "1244567", "email":"test@test.ru" },
  "address": {"country": "Россия", "region": "Москва", "district": "", "town": "Москва", "locality": "", "street": "Обводного канала", "house": "199", "flat": "", "block": "", "building": "", "zipcode": "190020"}
}'
```

| Параметр | Обязательность | Описание |
|---------------------------------|----------------|--------------------------------------------------------------------------------------|
| `orderId`<br>  string | Обязательно | Идентификатор заказа, сгенерированный на стороне маркетплейса. |
| `offerIds`<br> Array of [{offer}](#offer-3)| Обязательно | Массив объектов с идентификаторами товаров и их количество. |
| `regionId`<br> integer | Обязательно | Идентификатор региона из списка. |
| `pointId`<br>string | Обязательно | Идентификатор точки самовывоза из CSV, 0 - если выбрана доставка курьером. |
| `DeliveryId`<br>integer  | Необязательно | Идентификатор службы доставки в системе партнера. |
| `productCode`<br>string  | Обязательно | Код кредитного продукта.<br> Примеры:<ul><li>0-0-3</li><li>0-0-6</li><li>0-0-10</li><li>0-0-12</li><li>0-0-18</li><li>0-0-24</li><li>0-0-36</li></ul> |
| `address`<br> [{address}](#address)| Необязательно | Адрес в формате КЛАДР, указывается, если выбрана доставка курьером. |
| `client`<br> [{clientInfo}](#clientinfoubu)| Обязательно(для метода reserve) | Информация о клиенте. |
                           
**Объект offer**

| Параметр | Обязательность | Описание |
|------------------------|----------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `offerId`<br> integer | Обязательно | Идентификатор товара из YML-каталога. |
| `quantity`<br> integer | Обязательно | Количество единиц товара. |
| `price`<br> float | Обязательно | Цена товара с учетом скидки, предоставляемой партнером. Размер скидки зависит от используемого кредитного продукта (срока рассрочки) и согласован с партнером. |
| `priceTotal`<br> float | Обязательно | Цена товара без учета скидки, то есть стоимость товара, которую партнер заявил в своем каталоге. |
 
**Объект address**

| Параметр | Обязательность | Описание |
|-----------------------|----------------|----------------------|
| `country`<br>  string | Обязательно | Код страны по КЛАДР. |
| `region`<br> string | Обязательно | Регион. |
| `district`<br>string | Обязательно | Район. |
| `town`<br>string | Обязательно | Город. |
| `locality`<br>string | Обязательно | Населенный пункт. |
| `street` <br>string | Обязательно | Улица. |
| `house`<br> string | Обязательно | Дом. |
| `flat` <br>string | Необязательно | Квартира. |
| `block` <br>string | Необязательно | Корпус. |
| `building` <br>string | Необязательно | Строение. |
| `zipcode` <br>string | Обязательно | Индекс. |

**Объект clientInfo**

| Параметр | Обязательность | Описание |
|------------------------|----------------|---------------------------------------------------|
| `firstName`<br>string | Обязательно | Имя клиента. |
| `lastName`<br>string | Обязательно | Фамилия клиента. |
| `middleName`<br>string | Необязательно | Отчество клиента. |
| `email`<br>string | Необязательно | E-mail. |
| `phone`<br>string | Обязательно | Телефон клиента. Номер должен быть ровно 10 цифр. |

### Параметры ответа
`HTTP status code 200 OK — Товар зарезервирован(ответ на метод reserve).`

```json
{
"orderId": "18022600000999",
"status": "reserved",
"PartnerOrderId": "12345"
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|------------------------------------------------------------|
| `orderId` <br>string | Обязательно | Идентификатор заказа, сгенерированный на стороне Маркетплейса. |
| `status`<br> string | Обязательно | значение: "reserved" |
| `PartnerOrderId` <br>string | Необязательно | Идентификатор заказа, сгенерированный на стороне партнера. |


`HTTP status code 200 OK — Товар недоступен для резервирования.`

```json
{
"orderId": "18022600000999",
"status": "cancelled",
"reason": "not in stock"
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|------------------------------------------------------------------------------|
| `orderId` <br>string | Обязательно | Идентификатор заказа, сгенерированный на стороне Маркетплейса. |
| `status`<br> string | Обязательно | значение: 'cancelled'. |
| `reason` <br>string | Обязательно | Причина отказа в резервировании (Пример: 'address is not in delivery area'). |
| `PartnerOrderId` <br>string | Необязательно | Идентификатор заказа, сгенерированный на стороне партнера. |

### Обработка ошибок 
 > Пример ответа в JSON:
 
```json
{"errorFields":[
      {"clientInfo": 
        {
        "phone": "phone is required"
        }
      }
  ]
}
```

| Параметр | Описание |
|----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `5xx`  | Внутренняя ошибка сервера партнера. |
| `422` | Неверный формат запроса (указаны неверные или не указаны обязательные параметры запроса).<br> В теле запроса необходимо передавать поля, которые переданы с ошибкой и указывать в чем она заключается. Формулировка ошибки может быть произвольной строкой (см. пример). |
| `404` | Заказ не существует или указан неверный идентификатор. |

##POST /order/:orderId/status
**Передача статуса кредитной заявки партнера**

Данным методом Маркетплейс передает партнеру статус заявки в случае подписания(signed), что для партнера служит сигналом для доставки заказа клиенту или на пункт самовывоза. Либо отменяет заказ.

<aside class="notice">
Возможные сценарии:
</aside>

| Статус | Описание | Действия партнера |
|-------------------------------|----------------------------------------------------------------------|----------------------------------------------------------------------------------|
| Кредит отменен<br>(CANCELLED) | Отказ клиента. Также можно интерпретировать как отмена бронирования. | Партнер отменяет заказ. |
| Кредит подписан<br>(SIGNED) | Покупатель подписал кредитный договор и ожидает получение товара. | Партнер может выдать товар на пункте самовывоза, либо начинает процесс доставки. |


### Входные параметры
`POST https://example.com/order/:orderId/status`

> Пример запроса POST /order/:orderId/status:

```shell
curl -X POST \
  https://example.com/order/1234567890/status/ \
  -H 'Content-Type: application/json' \
  -H 'cache-control: no-cache' \
  -d '{
    "orderId":"1234567890",
    "PartnerOrderId":"777",
    "status":"SIGNED"
  }'
```
| Параметр | Обязательность | Описание |
|----------------------------|----------------|------------------------------------------------------------------------------------------------------------|
| `orderId`<br>string | Обязательно | Идентификатор заказа, сгенерированный на стороне Маркетплейс. |
| `PartnerOrderId`<br>string | Необязательно | Идентификатор заказа, сгенерированный на стороне партнера. Обязательный параметр, если партнер вернул этот параметр (номера заказа) на этапе резервирования. |
| `status`<br>string | Обязательно | Статус кредитной заявки (передается в качестве url-параметра).<br> Возможные варианты:<br><ul><li> CANCELLED - Кредит отменен.Отказ клиента.</li> <li>SIGNED - Кредит подписан.</li></ul> |

### Параметры ответа
`HTTP status code 200 OK —  Товар принят в обработку.`

> Примеры ответов в JSON:

```json
{
  "orderId": "18022600000999",
  "PartnerOrderId": "12345",
  "status": "reserved"
 
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|------------------------------------------------------------|
| `orderId`<br> string | Обязательно | Идентификатор заказа, сгенерированный на стороне маркетплейса |
| `PartnerOrderId` <br>string | Необязательно | Идентификатор заказа, сгенерированный на стороне партнера. |
| `status`<br> string | Обязательно | Значение: 'reserved' |





`HTTP status code 200 OK — Товар доставляется.`

```json
{
  "orderId": "18022600000999",
  "PartnerOrderId": "12345",
  "status": "delivering"
  
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|------------------------------------------------------------|
| `orderId`<br> string      | Обязательно  | Идентификатор заказа, сгенерированный на стороне маркетплейса |
| `PartnerOrderId` <br>string | Необязательно | Идентификатор заказа, сгенерированный на стороне партнера. |
| `status`<br> string | Обязательно | Значение: 'delivering'. |




`HTTP status code 200 OK — Товар не будет доставлен(Отмена заказа).`

```json
{
  "orderId": "18022600000999",
  "PartnerOrderId": "12345",
  "status": "cancelled",
  "reason": "address is not in delivery area"
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|-------------------------------------------------------------|
| `orderId`<br> string      | Обязательно  | Идентификатор заказа, сгенерированный на стороне маркетплейса |
| `PartnerOrderId` <br>string | Необязательно | Идентификатор заказа, сгенерированный на стороне партнера. |
| `status`<br> string | Обязательно | Значение: 'reserved' |
| `reason` <br> string | Обязательно | Причина отказа (Пример: 'address is not in delivery area'). |


### Обработка ошибок 
 > Пример ответа в JSON:
 
```json
{"errorFields":[
    {
      "status": "not valid status"
    } 
  ]
}
```

| Параметр | Описание |
|----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `5xx`  | Внутренняя ошибка сервера партнера. |
| `422` | Неверный формат запроса (указаны неверные или не указаны обязательные параметры запроса).<br> В теле запроса необходимо передавать поля, которые переданы с ошибкой и указывать в чем она заключается. Формулировка ошибки может быть произвольной строкой (см. пример). |
| `404` | Заказ не существует или указан неверный идентификатор. |



##GET /order/:orderId
> Пример запроса GET /order/:orderId:

```shell
curl -X GET \
  https://example.com/order/1234567890 \
  -H 'cache-control: no-cache' \

```

`GET https://example.com/order/:orderId`

### Логика ответа

Возможные сценарии:

| Статус | Описания | Действия MarketPlace |
|----------------------------|---------------------------------------------------|---------------------------------------------------------------------------------|
| Товар зарезервирован (reserved) | Партнер подтвердил, что выбранный товар зарезервирован до момента подписания Покупателем Кредитного договора | MarketPlace отправляет договор на подписание (в случае курьерской доставки), либо готовит печатные формы договора (в случае подписания на торговой точке партнера). |
| Товар находится в процессе доставки (delivering) | Партнер сообщает, что товар находится в процессе доставки Покупателю. | MarketPlace ожидает получение финального статуса. |
| Товар доставлен (delivered) | Партнер сообщает, что товар доставлен/выдан Покупателю. | MarketPlace начинает процедуру взаиморасчета с партнером. |
| Заказ отклонен (cancelled) | Партнер сообщает, что заказ отклонен. Дополнительно указывает причину отказа в поле reason. | MarketPlace отклоняет заказ внутри своей базы данных, информирует Покупателя об отмене. |

<aside class="warning">
После того как партнеру пришел статус SIGNED, отменить заказ в автоматическом режиме невозможно, т.к. у клиента уже на руках подписанный кредитный договор, который необходимо аннулировать через клиентскую поддержку Marketplace.<br>
Для этого необходимо:
<ul><li>Обратиться в поддержку Marketplace по почте <a href="mailto:mpsupport@homecredit.ru">mpsupport@homecredit.ru</a>, указав в письме номер кредитного договора (можно узнать в партнерском ЛК), и причину аннулирования договора</li><li>Отправлять корректный ответ на метод GET /order/:orderId: с "status": "cancelled" и указанием причины в поле "reason"</li></ul>
</aside>

###Параметры ответа
`HTTP status code 200 OK — Товар зарезервирован.`
 
```json
{
    "orderId": "18022600000999",
    "status": "reserved",
    "PartnerOrderId": "12345"
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `orderId`<br> string | Обязательно  | Идентификатор заказа, сгенерированный на стороне Маркетплейс.| 
| `status`<br> string | Обязательно | Значение: 'reserved' |
| `PartnerOrderId`<br> string | Необязательно  | Идентификатор заказа, сгенерированный на стороне партнера. Обязательный параметр, если партнер вернул этот параметр (номера заказа) на этапе резервирования |

`HTTP status code 200 OK — Товар доставляется.`
 
```json
{
    "orderId": "18022600000999",
    "status": "delivering",
    "PartnerOrderId": "12345",
    "trackId": "TK456789"
}
```
| Параметр | Обязательность | Описание |
|-----------------------------|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `orderId`<br> string | Обязательно  | Идентификатор заказа, сгенерированный на стороне Маркетплейс.| 
| `status`<br> string | Обязательно | Значение: 'delivering' |
| `PartnerOrderId`<br> string | Необязательно  | Идентификатор заказа, сгенерированный на стороне партнера. Обязательный параметр, если партнер вернул этот параметр (номера заказа) на этапе резервирования |
| `trackId`<br> string | Необязательно | Id для трэкинга заказа, доставляемого транспортной компанией |

`HTTP status code 200 OK — Заказ доставлен.`
 
```json
{
    "orderId": "18022600000999",
    "status": "delivered",
    "PartnerOrderId": "12345"
}
```
| Параметр | Обязательность | Описание |
|-----------------------------|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `orderId`<br> string | Обязательно  | Идентификатор заказа, сгенерированный на стороне Маркетплейс.| 
| `status`<br> string | Обязательно | Значение: 'delivered' |
| `PartnerOrderId`<br> string | Необязательно  | Идентификатор заказа, сгенерированный на стороне партнера. Обязательный параметр, если партнер вернул этот параметр (номера заказа) на этапе резервирования |

`HTTP status code 200 OK — Заказ отклонен.`

```json
{
    "orderId": "18022600000999",
    "status": "cancelled",
    "reason": "not in stock",
    "PartnerOrderId": "12345"
}
```

| Параметр | Обязательность | Описание |
|-----------------------------|----------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `orderId`<br> string | Обязательно  | Идентификатор заказа, сгенерированный на стороне Маркетплейс.| 
| `status`<br> string | Обязательно | Значение: 'cancelled' |
| `PartnerOrderId`<br> string | Необязательно  | Идентификатор заказа, сгенерированный на стороне партнера. Обязательный параметр, если партнер вернул этот параметр (номера заказа) на этапе резервирования |
| `reason` <br> string | Обязательно | причина отказа (Пример: 'not in stock') |

### Обработка ошибок 
 > Пример ответа в JSON:
 
```json
{"errorFields":[
    {
      "status": "not valid Id"
    } 
  ]
}
```

| Код HTTP | Описание |
|----------|--------------------------------------------------------|
| 5xx | Внутренняя ошибка сервера партнера. |
| 404 | Заказ не существует или указан неверный идентификатор. |

<aside class="warning">
В случае возникновения ошибки 5хх произойдет повторный запрос через 60 секунд, если ошибка повторится, партнеру перестанут поступать новые заказы. После пяти попыток с интервалом в минуту партнеру будет направлено email-уведомление о неполадках на его стороне, после чего партнер будет отключен от системы до тех пор, пока не сообщит о том, что работоспособность восстановлена.
</aside>